import{_ as X,r as R,b as f,o as S,c as T,d as i,w as h,n as A,F as V,f as x,u as Y,e as m,t as k,k as P,p as q,g as U,a as B}from"./index-e32c1c5c.js";import{S as y,F as v,e as g,T as j,C as O,cy as J,cz as D,V as Z,M as K,b as u,d as w,G as _,k as Q,h as F,j as W,P as G,cu as $}from"./Select-bfcceaf6.js";import"./index-820b305b.js";const ee=[{label:"EPSG:3857(大坐标)",value:"EPSG:3857",state:!0},{label:"EPSG:4326(小坐标)",value:"EPSG:4326",state:!0},{label:"EPSG:4490(中国大地2000)",value:"EPSG:4490",state:!1}],I={"HTC-轮廓":[new y({fill:new v({color:"#838485"}),stroke:new g({color:"#838485",width:1.5})})],"HTC-停车位":[new y({fill:new v({color:"#0fa27d"}),stroke:new g({color:"#988a8a",width:.5})})],"HTC-残疾人网格":[new y({fill:new v({color:"#FFAC5E"}),stroke:new g({color:"#FFAC5E",width:.5})})],"HTC-车位号":[new y({text:new j({font:"bold 3px Arial",fill:new v({color:"#485759"}),text:"",textAlign:"center"})})],"HTC-文字":[new y({text:new j({font:"bold 12px Arial",fill:new v({color:"#879294"}),text:"",textAlign:"center"})})],"HTC-标识":[new y({image:new O({radius:5,fill:new v({color:"rgba(255, 255, 255, 0.4)"}),stroke:new g({color:"#3399CC",width:.5})}),fill:new v({color:"rgba(255, 255, 255, 0.4)"}),stroke:new g({color:"#3399CC",width:.5})})]},z=function(r,t){var{Text:e,Layer:s}=JSON.parse(r.values_.properties);if(r.getGeometry().getType(),e&&s!="HTC-车位号"){var l=I[s]||[new y({fill:J,stroke:D})];return l[0].getText().setText(e),l}else if(e&&s=="HTC-车位号"){var l=I[s];return l[0].getText().setText(e),l}return I[s]};const te=r=>(q("data-v-6ba44de6"),r=r(),U(),r),ae=te(()=>B("div",{id:"map",tabindex:"0",class:"map"},null,-1)),N=R("A2-001"),b=R(""),C=R(""),H=R("EPSG:4326"),re={data(){return{key:"",mapInfoList:[],currentMapInfoList:[],currentMapInfo:null,startToEnd:[],map:"",view:"",tileLayer:"",vectorLayer:"",parkLayer:"",markLayer:"",roadLayer:"",shortestRoadLayer:"",startLayer:"",endLayer:"",carLayer:"",carStyleLayer:"",clusterSource:"",showMarkSwitch:!1,showRoadSwitch:!1,checkRoadSwitch:!1,showCarSwitch:!1,showSelectTipSwitch:!1,showHoverTipSwitch:!1,carSelect:""}},methods:{printMapInfo(){console.table({坐标系:this.view.getProjection().getCode(),深度:this.view.getZoom(),分辨率:this.view.getResolution(),图层数:this.map.getLayers().getLength()}),console.log(this.view)},initView(){this.view=new Z({projection:"EPSG:4326",center:[0,0],zoom:1,interactions:[]})},initMap(){this.map=new K({target:"map",controls:[],layers:[],view:this.view})},listMap(){var r={layerType:"base"};A.post("http://42.192.222.62:10010/mapinfo/page",r).then(t=>{console.log(t.data),this.mapInfoList=t.data.data})},resetMap(){this.map.removeLayer(this.shortestRoadLayer),this.map.removeLayer(this.startLayer),this.map.removeLayer(this.endLayer),this.map.removeLayer(this.carLayer),this.map.removeLayer(this.carStyleLayer),this.map.removeLayer(this.roadLayer),this.map.removeLayer(this.markLayer),this.map.removeLayer(this.parkLayer),this.showMarkSwitch=!1,this.showRoadSwitch=!1,this.checkRoadSwitch=!1,this.showMarkSwitch=!1,this.showSelectTipSwitch=!1,this.showHoverTipSwitch=!1},changeMap(r){this.resetMap(),console.log(r),this.currentMapInfoList=this.mapInfoList.filter(L=>L.park_name==r),console.log(this.currentMapInfoList);var t=C.value||this.currentMapInfoList[0].layer_level;this.currentMapInfo=this.currentMapInfoList.filter(L=>L.layer_level==t)[0],this.currentMapInfo=this.currentMapInfoList[0],b.value=r,C.value=this.currentMapInfo.layer_level,console.table(this.currentMapInfo);var{layer_name:e,extent:s,center:l}=this.currentMapInfo,o=e.toLowerCase();this.parkLayer=new u({source:new w({format:new _,url:`http://42.192.222.62:8080/geoserver/wfs?version=1.1.0&request=GetFeature&typeName=park_map:${o}&outputFormat=application/json&srsname=EPSG:4326`}),style:z}),this.map.addLayer(this.parkLayer);var n=l.replace(/[{}]/g,"").split(",");console.log(n);var p=s.replace(/[()]/g,"").split(","),c=parseFloat(p[0]),d=parseFloat(p[2]),a=parseFloat(p[1]),M=parseFloat(p[3]);this.view.fit([c,d,a,M]),this.map.render()},changeLevel(r){this.resetMap(),this.map.removeLayer(this.parkLayer),console.log(r),this.currentMapInfo=this.mapInfoList.filter(M=>M.layer_name==r)[0],console.table(this.currentMapInfo);var{layer_name:t,extent:e,center:s}=this.currentMapInfo,l=t.toLowerCase();this.parkLayer=new u({source:new w({format:new _,url:`http://42.192.222.62:8080/geoserver/wfs?version=1.1.0&request=GetFeature&typeName=park_map:${l}&outputFormat=application/json&srsname=EPSG:4326`}),style:z}),this.map.addLayer(this.parkLayer);var o=s.replace(/[{}]/g,"").split(",");this.view.setCenter([o[0],o[1]]);var n=e.replace(/[()]/g,"").split(","),p=parseFloat(n[0]),c=parseFloat(n[2]),d=parseFloat(n[1]),a=parseFloat(n[3]);this.view.fit([p,c,d,a]),this.map.render()},changeCoordinateType(){},doLoadMark(){if(this.showMarkSwitch=!this.showMarkSwitch,this.showMarkSwitch){var{layer_key:r,layer_level:t,layer_name:e,extent:s,center:l}=this.currentMapInfo,o=(r+"_"+t+"_mark").toLowerCase();this.markLayer=new u({source:new w({format:new _,url:`http://42.192.222.62:8080/geoserver/wfs?version=1.1.0&request=GetFeature&typeName=park_map:${o}&outputFormat=application/json&srsname=EPSG:4326`}),style:z}),this.map.addLayer(this.markLayer),console.log(this.markLayer.getStyle())}else this.map.removeLayer(this.markLayer)},doLoadRoad(){if(this.showRoadSwitch=!this.showRoadSwitch,this.showRoadSwitch){var{layer_key:r,layer_level:t,layer_name:e,extent:s,center:l}=this.currentMapInfo,o=(r+"_"+t+"_road").toLowerCase();this.roadLayer=new u({source:new w({format:new _,url:`http://42.192.222.62:8080/geoserver/wfs?version=1.1.0&request=GetFeature&typeName=park_map:${o}&outputFormat=application/json&srsname=EPSG:4326`})}),this.map.addLayer(this.roadLayer)}else this.map.removeLayer(this.roadLayer)},doLoadCarStyle(){if(console.log("doLoadCarStyle"),this.showCarSwitch=!this.showCarSwitch,this.showCarSwitch){this.carStyleLayer=new u({source:new w});var r=this.parkLayer.getSource().getFeatures();r.forEach(t=>{var{Text:e,Layer:s}=JSON.parse(t.values_.properties);if(s==="HTC-停车位"){var l=t.getGeometry().getCoordinates(),o=new Q([l]),n=new F({geometry:o});n.setStyle(I[s]),this.carStyleLayer.getSource().addFeature(n)}}),this.map.addLayer(this.carStyleLayer)}else this.map.removeLayer(this.carStyleLayer)},doHoverShowTip(){if(this.showHoverTipSwitch=!this.showHoverTipSwitch,this.showHoverTipSwitch){var r=t=>{};this.map.on("pointermove",r)}},doSelectShowTip(){if(this.showSelectTipSwitch=!this.showSelectTipSwitch,this.showSelectTipSwitch){const t=new y({stroke:new g({color:"red",width:.5}),text:new j({font:"bold 5px Arial",fill:new v({color:"#485759"}),text:"",textAlign:"center",rotation:-Math.PI/2})});this.carSelect=new W({style:t,pixelTolerance:50}),this.map.addInteraction(this.carSelect);var r=e=>{var s=e.selected[0];console.log(s),s.setStyle(t)};this.carSelect.on("select",r)}else this.carSelect.un("select",r)},doCheckStartToEnd(){if(this.checkRoadSwitch=!this.checkRoadSwitch,this.checkRoadSwitch){var r=t=>{var e=t.coordinate;this.startToEnd.push(e);var s=new F({geometry:new G(e)});s.setStyle(new y({image:new $({src:"../定位.png",anchor:[.5,1]})})),this.startToEnd.length==1?(this.startLayer=new u({source:new w}),this.startLayer.getSource().addFeature(s),this.map.addLayer(this.startLayer)):this.startToEnd.length==2?(this.endLayer=new u({source:new w}),this.endLayer.getSource().addFeature(s),this.map.addLayer(this.endLayer)):(this.startToEnd=[],this.map.removeLayer(this.shortestRoadLayer),this.map.removeLayer(this.startLayer),this.map.removeLayer(this.endLayer),this.map.removeLayer(this.carLayer),this.startLayer="",this.endLayer="")};this.map.on("singleclick",r)}else this.map.un("singleclick",r),this.startToEnd=[],this.map.removeLayer(this.shortestRoadLayer),this.map.removeLayer(this.startLayer),this.map.removeLayer(this.endLayer),this.map.removeLayer(this.carLayer),this.startLayer="",this.endLayer=""},doLoadShortestRoad(){var{layer_key:r,layer_level:t,layer_name:e,extent:s,center:l}=this.currentMapInfo,o=this.startToEnd[0],n=this.startToEnd[1],p=["x1:"+o[0],"y1:"+o[1],"x2:"+n[0],"y2:"+n[1],"layer_name:"+((r+"_"+t+"_road").toLowerCase()||"bj_hx_live_wks_0223_b2_road")];const c={version:"1.1.0",request:"GetFeature",typeName:"park_map:load_road_shortest_v2",outputFormat:"application/json",srsname:"EPSG:4326",viewparams:p.join(";")};var d=new URLSearchParams(c).toString();console.log(d),this.shortestRoadLayer=new u({source:new w({format:new _,url:"http://42.192.222.62:8080/geoserver/wfs?"+d}),style:new y({fill:new v({color:"#ff0000"}),stroke:new g({color:"#ff0000",width:4})})}),this.map.addLayer(this.shortestRoadLayer),this.map.render()},async doLoadCarRoad(){var r=[];await A.post(`http://42.192.222.62:10010/slotinfo?layer_level=${this.currentMapInfo.layer_level}&layer_key=${this.currentMapInfo.layer_key}&slot_num=${N.value}`).then(e=>{console.log(e.data),r=e.data.data}).catch(function(e){console.log(e),alert("未找到")}),this.carLayer=new u({source:new w});var t=new F({geometry:new G(r)});t.setStyle(new y({image:new $({src:"../定位.png",anchor:[0,0]})})),this.carLayer.getSource().addFeature(t),this.map.addLayer(this.carLayer),this.map.render(),this.startToEnd.push(r)},doTestRandomStart(){var{layer_key:r,layer_level:t,layer_name:e,extent:s,center:d}=this.currentMapInfo;console.log(s);var l=s.replace(/[()]/g,"").split(","),o=parseFloat(l[0]),n=parseFloat(l[2]),p=parseFloat(l[1]),c=parseFloat(l[3]),d=[parseFloat((Math.random()*(p-o)+o).toFixed(12)),parseFloat((Math.random()*(c-n)+n).toFixed(12))];console.log(d),this.startToEnd.push(d);var a=new F({geometry:new G(d)});a.setStyle(new y({image:new $({src:"../定位.png",anchor:[.5,1]})})),this.startLayer=new u({source:new w}),this.startLayer.getSource().addFeature(a),this.map.addLayer(this.startLayer),this.map.render()},doFastLoadCarRoad(){this.listMap(),this.showCarSwitch=!1,this.showMarkSwitch=!1,this.startToEnd=[],this.map.removeLayer(this.shortestRoadLayer),this.map.removeLayer(this.startLayer),this.map.removeLayer(this.endLayer),this.map.removeLayer(this.carLayer),this.map.removeLayer(this.shortestRoadLayer),this.map.removeLayer(this.carStyleLayer),this.map.removeLayer(this.parkLayer),this.map.removeLayer(this.markLayer),console.log(this.currentMapInfoList),console.log(this.currentMapInfo),console.log(this.mapInfoList);var{park_name:r,layer_key:t,layer_level:e,layer_name:s,extent:l,center:o}=this.currentMapInfo||this.mapInfoList[0];console.log(r,t),this.changeMap(r);var n=!1;this.map.on("rendercomplete",p=>{if(!n){this.doLoadCarStyle(),n=!n;var c=!1;this.map.on("rendercomplete",d=>{if(!c){this.doLoadMark(),c=!c;var a=!1;this.map.on("rendercomplete",M=>{if(!a){this.doTestRandomStart(),a=!a;var L=!1;this.map.on("rendercomplete",oe=>{if(!L){this.doLoadCarRoad(),L=!L;var E=!1;this.map.on("rendercomplete",le=>{E||(this.doLoadShortestRoad(),E=!E)})}})}})}})}})}},mounted(){this.listMap(),this.initView(),this.initMap()}},se=Object.assign(re,{__name:"index-pro",setup(r){return(t,e)=>{const s=f("el-option"),l=f("el-select"),o=f("el-button"),n=f("el-input"),p=f("a-layout-header"),c=f("a-layout-content"),d=f("a-layout");return S(),T("div",null,[i(d,null,{default:h(()=>[i(p,null,{default:h(()=>[i(l,{style:{width:"120px"},onChange:e[0]||(e[0]=a=>t.changeCoordinateType(H.value)),modelValue:H.value,"onUpdate:modelValue":e[1]||(e[1]=a=>H.value=a),placeholder:"Select",size:"small"},{default:h(()=>[(S(!0),T(V,null,x(Y(ee),a=>(S(),P(s,{key:a.value,label:a.label,value:a.value,disabled:!a.state},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"]),i(l,{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=a=>b.value=a),placeholder:"请选择车场地图",size:"small",onChange:e[3]||(e[3]=a=>t.changeMap(b.value))},{default:h(()=>[(S(!0),T(V,null,x(t.mapInfoList,a=>(S(),P(s,{key:a.layer_name,label:a.park_name,value:a.park_name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),i(l,{style:{width:"100px"},modelValue:C.value,"onUpdate:modelValue":e[4]||(e[4]=a=>C.value=a),placeholder:"请选择楼层",size:"small",onChange:e[5]||(e[5]=a=>t.changeLevel(C.value)),disabled:t.currentMapInfoList.length==0},{default:h(()=>[(S(!0),T(V,null,x(t.currentMapInfoList,a=>(S(),P(s,{key:a.layer_name,label:a.layer_level,value:a.layer_name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),i(o,{size:"small",onClick:e[6]||(e[6]=a=>t.printMapInfo())},{default:h(()=>[m("调试")]),_:1}),i(o,{size:"small",onClick:e[7]||(e[7]=a=>t.resetMap())},{default:h(()=>[m("重置")]),_:1}),i(o,{size:"small",onClick:e[8]||(e[8]=a=>t.doLoadMark())},{default:h(()=>[m(k(t.showMarkSwitch?"隐藏标注":"显示标注"),1)]),_:1}),i(o,{size:"small",onClick:e[9]||(e[9]=a=>t.doLoadRoad())},{default:h(()=>[m(k(t.showRoadSwitch?"隐藏道路":"显示道路"),1)]),_:1}),i(o,{size:"small",onClick:e[10]||(e[10]=a=>t.doLoadCarStyle())},{default:h(()=>[m(k(t.showCarSwitch?"隐藏车位渲染":"显示车位渲染"),1)]),_:1}),i(o,{size:"small",onClick:e[11]||(e[11]=a=>t.doSelectShowTip())},{default:h(()=>[m(k(t.showSelectTipSwitch?"关闭选中提示":"开启选中提示"),1)]),_:1}),i(o,{size:"small",onClick:e[12]||(e[12]=a=>t.doHoverShowTip())},{default:h(()=>[m(k(t.showHoverTipSwitch?"关闭悬浮提示":"开启悬浮提示"),1)]),_:1}),i(o,{size:"small",onClick:e[13]||(e[13]=a=>t.doCheckStartToEnd())},{default:h(()=>[m(k(t.checkRoadSwitch?"关闭选点":"开启选点"),1)]),_:1}),i(o,{size:"small",onClick:e[14]||(e[14]=a=>t.doLoadShortestRoad()),disabled:t.startToEnd.length!=2},{default:h(()=>[m("计算路径 ")]),_:1},8,["disabled"]),i(n,{placeholder:"请输入车位编号",size:"small",style:{width:"100px"},modelValue:N.value,"onUpdate:modelValue":e[15]||(e[15]=a=>N.value=a)},null,8,["modelValue"]),i(o,{size:"small",onClick:e[16]||(e[16]=a=>t.doLoadCarRoad())},{default:h(()=>[m("导航 ")]),_:1}),i(o,{size:"small",onClick:e[17]||(e[17]=a=>t.doFastLoadCarRoad())},{default:h(()=>[m("一键导航 ")]),_:1})]),_:1}),i(c,null,{default:h(()=>[ae]),_:1})]),_:1})])}}}),de=X(se,[["__scopeId","data-v-6ba44de6"]]);export{de as default};

import{L as Oi,l as Ai,m as Z,n as y,o as $t,p as Gi,q as Ni,r as Ne,s as ji,u as j,v as We,w as Xi,x as zi,y as Ui,z as rt,A as G,D as ct,H as ke,I as He,J as ut,K as Yi,N as Rt,O as dt,Q as Zi,R as Qt,U as Wi,W as je,X as qi,Y as gt,Z as Oe,_ as _e,$ as Xe,a0 as ze,a1 as Ki,a2 as Lt,a3 as B,a4 as ot,a5 as vt,a6 as v,a7 as It,a8 as Vi,a9 as Bi,aa as Hi,ab as $i,ac as Y,ad as Qi,ae as Jt,af as Ue,ag as Ji,ah as es,ai as Se,aj as Re,ak as ts,a as ft,al as is,am as ss,an as ns,ao as ce,ap as rs,E as _t,aq as os,ar as as,as as ls,at as hs,au as ei,av as cs,aw as us,ax as b,ay as Ee,b as ti,d as ii,az as ds,aA as at,aB as gs,aC as fs,aD as N,aE as _s,aF as Ye,h as se,P as Ae,aG as Ge,aH as Mt,aI as ms,aJ as si,aK as ni,aL as ri,k as oi,aM as Ts,aN as xs,aO as ai,aP as ne,aQ as Cs,aR as lt,aS as ps,aT as ys,aU as Es,aV as Fs,aW as ws,aX as Dt,aY as bt,aZ as kt,a_ as $e,a$ as ie,b0 as Ps,b1 as Ss,b2 as Rs,b3 as Ot,b4 as Ls,b5 as vs,b6 as mt,b7 as Ze,b8 as Tt,b9 as At,ba as Gt,bb as Nt,bc as Ce,bd as Is,be as Ms,bf as Ds}from"./Select-73cfa6a9.js";const Le={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class bs extends Oi{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0)}getPreload(){return this.get(Le.PRELOAD)}setPreload(e){this.set(Le.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(Le.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(Le.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}const ks=bs;let Os=class extends Ai{constructor(e,t,i){super(),i=i||{},this.tileCoord=e,this.state=t,this.interimTile=null,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(Z.CHANGE)}release(){this.state===y.ERROR&&this.setState(y.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){if(!this.interimTile)return this;let e=this.interimTile;do{if(e.getState()==y.LOADED)return this.transition_=0,e;e=e.interimTile}while(e);return this}refreshInterimChain(){if(!this.interimTile)return;let e=this.interimTile,t=this;do{if(e.getState()==y.LOADED){e.interimTile=null;break}else e.getState()==y.LOADING?t=e:e.getState()==y.IDLE?t.interimTile=e.interimTile:t=e;e=t.interimTile}while(e)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==y.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}load(){$t()}getAlpha(e,t){if(!this.transition_)return 1;let i=this.transitionStarts_[e];if(!i)i=t,this.transitionStarts_[e]=i;else if(i===-1)return 1;const s=t-i+1e3/60;return s>=this.transition_?1:Gi(s/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}};const li=Os;class As extends li{constructor(e,t,i,s,n,r){super(e,t,r),this.crossOrigin_=s,this.src_=i,this.key=i,this.image_=new Image,s!==null&&(this.image_.crossOrigin=s),this.unlisten_=null,this.tileLoadFunction_=n}getImage(){return this.image_}setImage(e){this.image_=e,this.state=y.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=y.ERROR,this.unlistenImage_(),this.image_=Gs(),this.changed()}handleImageLoad_(){const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=y.LOADED:this.state=y.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==y.ERROR&&(this.state=y.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==y.IDLE&&(this.state=y.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Ni(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function Gs(){const l=Ne(1,1);return l.fillStyle="rgba(0,0,0,0)",l.fillRect(0,0,1,1),l.canvas}const hi=As,Ns=.5,js=10,jt=.25;class Xs{constructor(e,t,i,s,n,r){this.sourceProj_=e,this.targetProj_=t;let o={};const h=ji(this.targetProj_,this.sourceProj_);this.transformInv_=function(C){const m=C[0]+"/"+C[1];return o[m]||(o[m]=h(C)),o[m]},this.maxSourceExtent_=s,this.errorThresholdSquared_=n*n,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!s&&!!this.sourceProj_.getExtent()&&j(s)==j(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?j(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?j(this.targetProj_.getExtent()):null;const a=We(i),c=Xi(i),d=zi(i),u=Ui(i),f=this.transformInv_(a),g=this.transformInv_(c),_=this.transformInv_(d),x=this.transformInv_(u),p=js+(r?Math.max(0,Math.ceil(Math.log2(rt(i)/(r*r*256*256)))):0);if(this.addQuad_(a,c,d,u,f,g,_,x,p),this.wrapsXInSource_){let C=1/0;this.triangles_.forEach(function(m,T,E){C=Math.min(C,m.source[0][0],m.source[1][0],m.source[2][0])}),this.triangles_.forEach(m=>{if(Math.max(m.source[0][0],m.source[1][0],m.source[2][0])-C>this.sourceWorldWidth_/2){const T=[[m.source[0][0],m.source[0][1]],[m.source[1][0],m.source[1][1]],[m.source[2][0],m.source[2][1]]];T[0][0]-C>this.sourceWorldWidth_/2&&(T[0][0]-=this.sourceWorldWidth_),T[1][0]-C>this.sourceWorldWidth_/2&&(T[1][0]-=this.sourceWorldWidth_),T[2][0]-C>this.sourceWorldWidth_/2&&(T[2][0]-=this.sourceWorldWidth_);const E=Math.min(T[0][0],T[1][0],T[2][0]);Math.max(T[0][0],T[1][0],T[2][0])-E<this.sourceWorldWidth_/2&&(m.source=T)}})}o={}}addTriangle_(e,t,i,s,n,r){this.triangles_.push({source:[s,n,r],target:[e,t,i]})}addQuad_(e,t,i,s,n,r,o,h,a){const c=G([n,r,o,h]),d=this.sourceWorldWidth_?j(c)/this.sourceWorldWidth_:null,u=this.sourceWorldWidth_,f=this.sourceProj_.canWrapX()&&d>.5&&d<1;let g=!1;if(a>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const x=G([e,t,i,s]);g=j(x)/this.targetWorldWidth_>jt||g}!f&&this.sourceProj_.isGlobal()&&d&&(g=d>jt||g)}if(!g&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!ct(c,this.maxSourceExtent_))return;let _=0;if(!g&&(!isFinite(n[0])||!isFinite(n[1])||!isFinite(r[0])||!isFinite(r[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(h[0])||!isFinite(h[1]))){if(a>0)g=!0;else if(_=(!isFinite(n[0])||!isFinite(n[1])?8:0)+(!isFinite(r[0])||!isFinite(r[1])?4:0)+(!isFinite(o[0])||!isFinite(o[1])?2:0)+(!isFinite(h[0])||!isFinite(h[1])?1:0),_!=1&&_!=2&&_!=4&&_!=8)return}if(a>0){if(!g){const x=[(e[0]+i[0])/2,(e[1]+i[1])/2],p=this.transformInv_(x);let C;f?C=(ke(n[0],u)+ke(o[0],u))/2-ke(p[0],u):C=(n[0]+o[0])/2-p[0];const m=(n[1]+o[1])/2-p[1];g=C*C+m*m>this.errorThresholdSquared_}if(g){if(Math.abs(e[0]-i[0])<=Math.abs(e[1]-i[1])){const x=[(t[0]+i[0])/2,(t[1]+i[1])/2],p=this.transformInv_(x),C=[(s[0]+e[0])/2,(s[1]+e[1])/2],m=this.transformInv_(C);this.addQuad_(e,t,x,C,n,r,p,m,a-1),this.addQuad_(C,x,i,s,m,p,o,h,a-1)}else{const x=[(e[0]+t[0])/2,(e[1]+t[1])/2],p=this.transformInv_(x),C=[(i[0]+s[0])/2,(i[1]+s[1])/2],m=this.transformInv_(C);this.addQuad_(e,x,C,s,n,p,m,h,a-1),this.addQuad_(x,t,i,C,p,r,o,m,a-1)}return}}if(f){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}_&11||this.addTriangle_(e,i,s,n,o,h),_&14||this.addTriangle_(e,i,t,n,o,r),_&&(_&13||this.addTriangle_(t,s,e,r,h,n),_&7||this.addTriangle_(t,s,i,r,h,o))}calculateSourceExtent(){const e=ut();return this.triangles_.forEach(function(t,i,s){const n=t.source;He(e,n[0]),He(e,n[1]),He(e,n[2])}),e}getTriangles(){return this.triangles_}}const zs=Xs;let Qe;const ge=[];function Xt(l,e,t,i,s){l.beginPath(),l.moveTo(0,0),l.lineTo(e,t),l.lineTo(i,s),l.closePath(),l.save(),l.clip(),l.fillRect(0,0,Math.max(e,i)+1,Math.max(t,s)),l.restore()}function Je(l,e){return Math.abs(l[e*4]-210)>2||Math.abs(l[e*4+3]-.75*255)>2}function Us(){if(Qe===void 0){const l=Ne(6,6,ge);l.globalCompositeOperation="lighter",l.fillStyle="rgba(210, 0, 0, 0.75)",Xt(l,4,5,4,0),Xt(l,4,5,0,5);const e=l.getImageData(0,0,3,3).data;Qe=Je(e,0)||Je(e,4)||Je(e,8),gt(l),ge.push(l.canvas)}return Qe}function zt(l,e,t,i){const s=Yi(t,e,l);let n=Rt(e,i,t);const r=e.getMetersPerUnit();r!==void 0&&(n*=r);const o=l.getMetersPerUnit();o!==void 0&&(n/=o);const h=l.getExtent();if(!h||dt(h,s)){const a=Rt(l,n,s)/n;isFinite(a)&&a>0&&(n/=a)}return n}function Ys(l,e,t,i){const s=Zi(t);let n=zt(l,e,s,i);return(!isFinite(n)||n<=0)&&Qt(t,function(r){return n=zt(l,e,r,i),isFinite(n)&&n>0}),n}function Zs(l,e,t,i,s,n,r,o,h,a,c,d){const u=Ne(Math.round(t*l),Math.round(t*e),ge);if(d||(u.imageSmoothingEnabled=!1),h.length===0)return u.canvas;u.scale(t,t);function f(T){return Math.round(T*t)/t}u.globalCompositeOperation="lighter";const g=ut();h.forEach(function(T,E,F){Wi(g,T.extent)});const _=j(g),x=je(g),p=Ne(Math.round(t*_/i),Math.round(t*x/i),ge);d||(p.imageSmoothingEnabled=!1);const C=t/i;h.forEach(function(T,E,F){const P=T.extent[0]-g[0],S=-(T.extent[3]-g[3]),I=j(T.extent),O=je(T.extent);T.image.width>0&&T.image.height>0&&p.drawImage(T.image,a,a,T.image.width-2*a,T.image.height-2*a,P*C,S*C,I*C,O*C)});const m=We(r);return o.getTriangles().forEach(function(T,E,F){const P=T.source,S=T.target;let I=P[0][0],O=P[0][1],H=P[1][0],$=P[1][1],Q=P[2][0],me=P[2][1];const X=f((S[0][0]-m[0])/n),W=f(-(S[0][1]-m[1])/n),w=f((S[1][0]-m[0])/n),k=f(-(S[1][1]-m[1])/n),q=f((S[2][0]-m[0])/n),z=f(-(S[2][1]-m[1])/n),te=I,M=O;I=0,O=0,H-=te,$-=M,Q-=te,me-=M;const U=[[H,$,0,0,w-X],[Q,me,0,0,q-X],[0,0,H,$,k-W],[0,0,Q,me,z-W]],L=qi(U);if(L){if(u.save(),u.beginPath(),Us()||!d){u.moveTo(w,k);const R=4,re=X-w,J=W-k;for(let D=0;D<R;D++)u.lineTo(w+f((D+1)*re/R),k+f(D*J/(R-1))),D!=R-1&&u.lineTo(w+f((D+1)*re/R),k+f((D+1)*J/(R-1)));u.lineTo(q,z)}else u.moveTo(w,k),u.lineTo(X,W),u.lineTo(q,z);u.clip(),u.transform(L[0],L[2],L[1],L[3],X,W),u.translate(g[0]-te,g[3]-M),u.scale(i/t,-i/t),u.drawImage(p.canvas,0,0),u.restore()}}),gt(p),ge.push(p.canvas),c&&(u.save(),u.globalCompositeOperation="source-over",u.strokeStyle="black",u.lineWidth=1,o.getTriangles().forEach(function(T,E,F){const P=T.target,S=(P[0][0]-m[0])/n,I=-(P[0][1]-m[1])/n,O=(P[1][0]-m[0])/n,H=-(P[1][1]-m[1])/n,$=(P[2][0]-m[0])/n,Q=-(P[2][1]-m[1])/n;u.beginPath(),u.moveTo(O,H),u.lineTo(S,I),u.lineTo($,Q),u.closePath(),u.stroke()}),u.restore()),u.canvas}class Ws extends li{constructor(e,t,i,s,n,r,o,h,a,c,d,u){super(n,y.IDLE,{interpolate:!!u}),this.renderEdges_=d!==void 0?d:!1,this.pixelRatio_=o,this.gutter_=h,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=s,this.wrappedTileCoord_=r||n,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const f=s.getTileCoordExtent(this.wrappedTileCoord_),g=this.targetTileGrid_.getExtent();let _=this.sourceTileGrid_.getExtent();const x=g?Oe(f,g):f;if(rt(x)===0){this.state=y.EMPTY;return}const p=e.getExtent();p&&(_?_=Oe(_,p):_=p);const C=s.getResolution(this.wrappedTileCoord_[0]),m=Ys(e,i,x,C);if(!isFinite(m)||m<=0){this.state=y.EMPTY;return}const T=c!==void 0?c:Ns;if(this.triangulation_=new zs(e,i,x,_,m*T,C),this.triangulation_.getTriangles().length===0){this.state=y.EMPTY;return}this.sourceZ_=t.getZForResolution(m);let E=this.triangulation_.calculateSourceExtent();if(_&&(e.canWrapX()?(E[1]=_e(E[1],_[1],_[3]),E[3]=_e(E[3],_[1],_[3])):E=Oe(E,_)),!rt(E))this.state=y.EMPTY;else{const F=t.getTileRangeForExtentAndZ(E,this.sourceZ_);for(let P=F.minX;P<=F.maxX;P++)for(let S=F.minY;S<=F.maxY;S++){const I=a(this.sourceZ_,P,S,o);I&&this.sourceTiles_.push(I)}this.sourceTiles_.length===0&&(this.state=y.EMPTY)}}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{t&&t.getState()==y.LOADED&&e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),image:t.getImage()})}),this.sourceTiles_.length=0,e.length===0)this.state=y.ERROR;else{const t=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(t),s=typeof i=="number"?i:i[0],n=typeof i=="number"?i:i[1],r=this.targetTileGrid_.getResolution(t),o=this.sourceTileGrid_.getResolution(this.sourceZ_),h=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Zs(s,n,this.pixelRatio_,o,this.sourceTileGrid_.getExtent(),r,h,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=y.LOADED}this.changed()}load(){if(this.state==y.IDLE){this.state=y.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(t=>{const i=t.getState();if(i==y.IDLE||i==y.LOADING){e++;const s=Xe(t,Z.CHANGE,function(n){const r=t.getState();(r==y.LOADED||r==y.ERROR||r==y.EMPTY)&&(ze(s),e--,e===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(s)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(t,i,s){t.getState()==y.IDLE&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(ze),this.sourcesListenerKeys_=null}release(){this.canvas_&&(gt(this.canvas_.getContext("2d")),ge.push(this.canvas_),this.canvas_=null),super.release()}}const ht=Ws;class ci{constructor(e,t,i,s){this.minX=e,this.maxX=t,this.minY=i,this.maxY=s}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function le(l,e,t,i,s){return s!==void 0?(s.minX=l,s.maxX=e,s.minY=t,s.maxY=i,s):new ci(l,e,t,i)}const ui=ci;class qs extends Ki{constructor(e){super(e),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=ut(),this.tmpTileRange_=new ui(0,0,0,0)}isDrawableTile(e){const t=this.getLayer(),i=e.getState(),s=t.getUseInterimTilesOnError();return i==y.LOADED||i==y.EMPTY||i==y.ERROR&&!s}getTile(e,t,i,s){const n=s.pixelRatio,r=s.viewState.projection,o=this.getLayer();let a=o.getSource().getTile(e,t,i,n,r);return a.getState()==y.ERROR&&o.getUseInterimTilesOnError()&&o.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(a)||(a=a.getInterimTile()),a}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),s=Lt(t.pixelToCoordinateTransform,e.slice()),n=i.getExtent();if(n&&!dt(n,s))return null;const r=t.pixelRatio,o=t.viewState.projection,h=t.viewState,a=i.getRenderSource(),c=a.getTileGridForProjection(h.projection),d=a.getTilePixelRatio(t.pixelRatio);for(let u=c.getZForResolution(h.resolution);u>=c.getMinZoom();--u){const f=c.getTileCoordForCoordAndZ(s,u),g=a.getTile(u,f[1],f[2],r,o);if(!(g instanceof hi||g instanceof ht)||g instanceof ht&&g.getState()===y.EMPTY)return null;if(g.getState()!==y.LOADED)continue;const _=c.getOrigin(u),x=B(c.getTileSize(u)),p=c.getResolution(u),C=Math.floor(d*((s[0]-_[0])/p-f[1]*x[0])),m=Math.floor(d*((_[1]-s[1])/p-f[2]*x[1])),T=Math.round(d*a.getGutterForProjection(h.projection));return this.getImageData(g.getImage(),C+T,m+T)}return null}loadedTileCallback(e,t,i){return this.isDrawableTile(i)?super.loadedTileCallback(e,t,i):!1}prepareFrame(e){return!!this.getLayer().getSource()}renderFrame(e,t){const i=e.layerStatesArray[e.layerIndex],s=e.viewState,n=s.projection,r=s.resolution,o=s.center,h=s.rotation,a=e.pixelRatio,c=this.getLayer(),d=c.getSource(),u=d.getRevision(),f=d.getTileGridForProjection(n),g=f.getZForResolution(r,d.zDirection),_=f.getResolution(g);let x=e.extent;const p=e.viewState.resolution,C=d.getTilePixelRatio(a),m=Math.round(j(x)/p*a),T=Math.round(je(x)/p*a),E=i.extent&&ot(i.extent,n);E&&(x=Oe(x,ot(i.extent,n)));const F=_*m/2/C,P=_*T/2/C,S=[o[0]-F,o[1]-P,o[0]+F,o[1]+P],I=f.getTileRangeForExtentAndZ(x,g),O={};O[g]={};const H=this.createLoadedTileFinder(d,n,O),$=this.tmpExtent,Q=this.tmpTileRange_;this.newTiles_=!1;const me=h?vt(s.center,p,h,e.size):void 0;for(let U=I.minX;U<=I.maxX;++U)for(let L=I.minY;L<=I.maxY;++L){if(h&&!f.tileCoordIntersectsViewport([g,U,L],me))continue;const R=this.getTile(g,U,L,e);if(this.isDrawableTile(R)){const D=v(this);if(R.getState()==y.LOADED){O[g][R.tileCoord.toString()]=R;let oe=R.inTransition(D);oe&&i.opacity!==1&&(R.endTransition(D),oe=!1),!this.newTiles_&&(oe||!this.renderedTiles.includes(R))&&(this.newTiles_=!0)}if(R.getAlpha(D,e.time)===1)continue}const re=f.getTileCoordChildTileRange(R.tileCoord,Q,$);let J=!1;re&&(J=H(g+1,re)),J||f.forEachTileCoordParentTileRange(R.tileCoord,H,Q,$)}const X=_/r*a/C;It(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/a,1/a,h,-m/2,-T/2);const W=Vi(this.pixelTransform);this.useContainer(t,W,this.getBackground(e));const w=this.context,k=w.canvas;Bi(this.inversePixelTransform,this.pixelTransform),It(this.tempTransform,m/2,T/2,X,X,0,-m/2,-T/2),k.width!=m||k.height!=T?(k.width=m,k.height=T):this.containerReused||w.clearRect(0,0,m,T),E&&this.clipUnrotated(w,e,E),d.getInterpolate()||(w.imageSmoothingEnabled=!1),this.preRender(w,e),this.renderedTiles.length=0;let q=Object.keys(O).map(Number);q.sort(Hi);let z,te,M;i.opacity===1&&(!this.containerReused||d.getOpaque(e.viewState.projection))?q=q.reverse():(z=[],te=[]);for(let U=q.length-1;U>=0;--U){const L=q[U],R=d.getTilePixelSize(L,a,n),J=f.getResolution(L)/_,D=R[0]*J*X,oe=R[1]*J*X,Ve=f.getTileCoordForCoordAndZ(We(S),L),pt=f.getTileCoordExtent(Ve),we=Lt(this.tempTransform,[C*(pt[0]-S[0])/_,C*(S[3]-pt[3])/_]),Ii=C*d.getGutterForProjection(n),yt=O[L];for(const Mi in yt){const ae=yt[Mi],Et=ae.tileCoord,Ft=Ve[1]-Et[1],Di=Math.round(we[0]-(Ft-1)*D),wt=Ve[2]-Et[2],bi=Math.round(we[1]-(wt-1)*oe),K=Math.round(we[0]-Ft*D),V=Math.round(we[1]-wt*oe),Te=Di-K,xe=bi-V,Pt=g===L,St=Pt&&ae.getAlpha(v(this),e.time)!==1;let Be=!1;if(!St)if(z){M=[K,V,K+Te,V,K+Te,V+xe,K,V+xe];for(let Pe=0,ki=z.length;Pe<ki;++Pe)if(g!==L&&L<te[Pe]){const A=z[Pe];ct([K,V,K+Te,V+xe],[A[0],A[3],A[4],A[7]])&&(Be||(w.save(),Be=!0),w.beginPath(),w.moveTo(M[0],M[1]),w.lineTo(M[2],M[3]),w.lineTo(M[4],M[5]),w.lineTo(M[6],M[7]),w.moveTo(A[6],A[7]),w.lineTo(A[4],A[5]),w.lineTo(A[2],A[3]),w.lineTo(A[0],A[1]),w.clip())}z.push(M),te.push(L)}else w.clearRect(K,V,Te,xe);this.drawTileImage(ae,e,K,V,Te,xe,Ii,Pt),z&&!St?(Be&&w.restore(),this.renderedTiles.unshift(ae)):this.renderedTiles.push(ae),this.updateUsedTiles(e.usedTiles,d,ae)}}return this.renderedRevision=u,this.renderedResolution=_,this.extentChanged=!this.renderedExtent_||!$i(this.renderedExtent_,S),this.renderedExtent_=S,this.renderedPixelRatio=a,this.renderedProjection=n,this.manageTilePyramid(e,d,f,a,n,x,g,c.getPreload()),this.scheduleExpireCache(e,d),this.postRender(w,e),i.extent&&w.restore(),w.imageSmoothingEnabled=!0,W!==k.style.transform&&(k.style.transform=W),this.container}drawTileImage(e,t,i,s,n,r,o,h){const a=this.getTileImage(e);if(!a)return;const c=v(this),d=t.layerStatesArray[t.layerIndex],u=d.opacity*(h?e.getAlpha(c,t.time):1),f=u!==this.context.globalAlpha;f&&(this.context.save(),this.context.globalAlpha=u),this.context.drawImage(a,o,o,a.width-2*o,a.height-2*o,i,s,n,r),f&&this.context.restore(),u!==d.opacity?t.animate=!0:h&&e.endTransition(c)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}scheduleExpireCache(e,t){if(t.canExpireCache()){const i=function(s,n,r){const o=v(s);o in r.usedTiles&&s.expireCache(r.viewState.projection,r.usedTiles[o])}.bind(null,t);e.postRenderFunctions.push(i)}}updateUsedTiles(e,t,i){const s=v(t);s in e||(e[s]={}),e[s][i.getKey()]=!0}manageTilePyramid(e,t,i,s,n,r,o,h,a){const c=v(t);c in e.wantedTiles||(e.wantedTiles[c]={});const d=e.wantedTiles[c],u=e.tileQueue,f=i.getMinZoom(),g=e.viewState.rotation,_=g?vt(e.viewState.center,e.viewState.resolution,g,e.size):void 0;let x=0,p,C,m,T,E,F;for(F=f;F<=o;++F)for(C=i.getTileRangeForExtentAndZ(r,F,C),m=i.getResolution(F),T=C.minX;T<=C.maxX;++T)for(E=C.minY;E<=C.maxY;++E)g&&!i.tileCoordIntersectsViewport([F,T,E],_)||(o-F<=h?(++x,p=t.getTile(F,T,E,s,n),p.getState()==y.IDLE&&(d[p.getKey()]=!0,u.isKeyQueued(p.getKey())||u.enqueue([p,c,i.getTileCoordCenter(p.tileCoord),m])),a!==void 0&&a(p)):t.useTile(F,T,E,n));t.updateCacheSize(x,n)}}const Ks=qs;class Vs extends ks{constructor(e){super(e)}createRenderer(){return new Ks(this)}}const Bs=Vs,Rn=Object.freeze(Object.defineProperty({__proto__:null,default:Bs},Symbol.toStringTag,{value:"Module"}));class di{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){const i=this.entries_[e];return Y(i!==void 0,15),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(e){const t=this.entries_[e];return Y(t!==void 0,15),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.key_;return e}getValues(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){if(this.containsKey(e))return this.entries_[e].value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){Y(!(e in this.entries_),16);const i={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[e]=i,++this.count_}setSize(e){this.highWaterMark=e}}const Ln=Object.freeze(Object.defineProperty({__proto__:null,default:di},Symbol.toStringTag,{value:"Module"}));function Ut(l,e,t,i){return i!==void 0?(i[0]=l,i[1]=e,i[2]=t,i):[l,e,t]}function Fe(l,e,t){return l+"/"+e+"/"+t}function gi(l){return Fe(l[0],l[1],l[2])}function vn(l){const[e,t,i]=l.substring(l.lastIndexOf("/")+1,l.length).split(",").map(Number);return Fe(e,t,i)}function Hs(l){return l.split("/").map(Number)}function $s(l){return(l[1]<<l[0])+l[2]}function Qs(l,e){const t=l[0],i=l[1],s=l[2];if(e.getMinZoom()>t||t>e.getMaxZoom())return!1;const n=e.getFullTileRange(t);return n?n.containsXY(i,s):!0}class Js extends di{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(e){for(;this.canExpireCache()&&!(this.peekLast().getKey()in e);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const e=this.peekFirstKey(),i=Hs(e)[0];this.forEach(s=>{s.tileCoord[0]!==i&&(this.remove(gi(s.tileCoord)),s.release())})}}const fi=Js,et={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},he=[0,0,0],ee=5;class en{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,Y(Qi(this.resolutions_,function(s,n){return n-s},!0),17);let t;if(!e.origins){for(let s=0,n=this.resolutions_.length-1;s<n;++s)if(!t)t=this.resolutions_[s]/this.resolutions_[s+1];else if(this.resolutions_[s]/this.resolutions_[s+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,Y(this.origins_.length==this.resolutions_.length,20));const i=e.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=We(i)),Y(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,Y(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:Jt,Y(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map(function(s,n){const r=new ui(Math.min(0,s[0]),Math.max(s[0]-1,-1),Math.min(0,s[1]),Math.max(s[1]-1,-1));if(i){const o=this.getTileRangeForExtentAndZ(i,n);r.minX=Math.max(o.minX,r.minX),r.maxX=Math.min(o.maxX,r.maxX),r.minY=Math.max(o.minY,r.minY),r.maxY=Math.min(o.maxY,r.maxY)}return r},this):i&&this.calculateTileRanges_(i)}forEachTileCoord(e,t,i){const s=this.getTileRangeForExtentAndZ(e,t);for(let n=s.minX,r=s.maxX;n<=r;++n)for(let o=s.minY,h=s.maxY;o<=h;++o)i([t,n,o])}forEachTileCoordParentTileRange(e,t,i,s){let n,r,o,h=null,a=e[0]-1;for(this.zoomFactor_===2?(r=e[1],o=e[2]):h=this.getTileCoordExtent(e,s);a>=this.minZoom;){if(this.zoomFactor_===2?(r=Math.floor(r/2),o=Math.floor(o/2),n=le(r,r,o,o,i)):n=this.getTileRangeForExtentAndZ(h,a,i),t(a,n))return!0;--a}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,i){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const n=e[1]*2,r=e[2]*2;return le(n,n+1,r,r+1,t)}const s=this.getTileCoordExtent(e,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(s,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,i){if(t>this.maxZoom||t<this.minZoom)return null;const s=e[0],n=e[1],r=e[2];if(t===s)return le(n,r,n,r,i);if(this.zoomFactor_){const h=Math.pow(this.zoomFactor_,t-s),a=Math.floor(n*h),c=Math.floor(r*h);if(t<s)return le(a,a,c,c,i);const d=Math.floor(h*(n+1))-1,u=Math.floor(h*(r+1))-1;return le(a,d,c,u,i)}const o=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(o,t,i)}getTileRangeExtent(e,t,i){const s=this.getOrigin(e),n=this.getResolution(e),r=B(this.getTileSize(e),this.tmpSize_),o=s[0]+t.minX*r[0]*n,h=s[0]+(t.maxX+1)*r[0]*n,a=s[1]+t.minY*r[1]*n,c=s[1]+(t.maxY+1)*r[1]*n;return Ue(o,a,h,c,i)}getTileRangeForExtentAndZ(e,t,i){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,he);const s=he[1],n=he[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,he);const r=he[1],o=he[2];return le(s,r,n,o,i)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),i=this.getResolution(e[0]),s=B(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*s[0]*i,t[1]-(e[2]+.5)*s[1]*i]}getTileCoordExtent(e,t){const i=this.getOrigin(e[0]),s=this.getResolution(e[0]),n=B(this.getTileSize(e[0]),this.tmpSize_),r=i[0]+e[1]*n[0]*s,o=i[1]-(e[2]+1)*n[1]*s,h=r+n[0]*s,a=o+n[1]*s;return Ue(r,o,h,a,t)}getTileCoordForCoordAndResolution(e,t,i){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,i)}getTileCoordForXYAndResolution_(e,t,i,s,n){const r=this.getZForResolution(i),o=i/this.getResolution(r),h=this.getOrigin(r),a=B(this.getTileSize(r),this.tmpSize_);let c=o*(e-h[0])/i/a[0],d=o*(h[1]-t)/i/a[1];return s?(c=Se(c,ee)-1,d=Se(d,ee)-1):(c=Re(c,ee),d=Re(d,ee)),Ut(r,c,d,n)}getTileCoordForXYAndZ_(e,t,i,s,n){const r=this.getOrigin(i),o=this.getResolution(i),h=B(this.getTileSize(i),this.tmpSize_);let a=(e-r[0])/o/h[0],c=(r[1]-t)/o/h[1];return s?(a=Se(a,ee)-1,c=Se(c,ee)-1):(a=Re(a,ee),c=Re(c,ee)),Ut(i,a,c,n)}getTileCoordForCoordAndZ(e,t,i){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,i)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const i=Ji(this.resolutions_,e,t||0);return _e(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return es(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,i=new Array(t);for(let s=this.minZoom;s<t;++s)i[s]=this.getTileRangeForExtentAndZ(e,s);this.fullTileRanges_=i}}const _i=en;function xt(l){let e=l.getDefaultTileGrid();return e||(e=pi(l),l.setDefaultTileGrid(e)),e}function mi(l,e,t){const i=e[0],s=l.getTileCoordCenter(e),n=qe(t);if(!dt(n,s)){const r=j(n),o=Math.ceil((n[0]-s[0])/r);return s[0]+=r*o,l.getTileCoordForCoordAndZ(s,i)}return e}function Ti(l,e,t,i){i=i!==void 0?i:"top-left";const s=Ci(l,e,t);return new _i({extent:l,origin:ts(l,i),resolutions:s,tileSize:t})}function xi(l){const e=l||{},t=e.extent||ft("EPSG:3857").getExtent(),i={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:Ci(t,e.maxZoom,e.tileSize,e.maxResolution)};return new _i(i)}function Ci(l,e,t,i){e=e!==void 0?e:is,t=B(t!==void 0?t:Jt);const s=je(l),n=j(l);i=i>0?i:Math.max(n/t[0],s/t[1]);const r=e+1,o=new Array(r);for(let h=0;h<r;++h)o[h]=i/Math.pow(2,h);return o}function pi(l,e,t,i){const s=qe(l);return Ti(s,e,t,i)}function qe(l){l=ft(l);let e=l.getExtent();if(!e){const t=180*ss.degrees/l.getMetersPerUnit();e=Ue(-t,-t,t,t)}return e}const In=Object.freeze(Object.defineProperty({__proto__:null,createForExtent:Ti,createForProjection:pi,createXYZ:xi,extentFromProjection:qe,getForProjection:xt,wrapX:mi},Symbol.toStringTag,{value:"Module"}));class tn extends ns{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.opaque_=e.opaque!==void 0?e.opaque:!1,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const t=[256,256];this.tileGrid&&B(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tileCache=new fi(e.cacheSize||0),this.tmpSize=[0,0],this.key_=e.key||"",this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(e,t){const i=this.getTileCacheForProjection(e);i&&i.expireCache(t)}forEachLoadedTile(e,t,i,s){const n=this.getTileCacheForProjection(e);if(!n)return!1;let r=!0,o,h,a;for(let c=i.minX;c<=i.maxX;++c)for(let d=i.minY;d<=i.maxY;++d)h=Fe(t,c,d),a=!1,n.containsKey(h)&&(o=n.get(h),a=o.getState()===y.LOADED,a&&(a=s(o)!==!1)),a||(r=!1);return r}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getOpaque(e){return this.opaque_}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,i,s,n){return $t()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:xt(e)}getTileCacheForProjection(e){const t=this.getProjection();return Y(t===null||ce(t,e),68),this.tileCache}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,i){const s=this.getTileGridForProjection(i),n=this.getTilePixelRatio(t),r=B(s.getTileSize(e),this.tmpSize);return n==1?r:rs(r,n,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){t=t!==void 0?t:this.getProjection();const i=this.getTileGridForProjection(t);return this.getWrapX()&&t.isGlobal()&&(e=mi(i,e,t)),Qs(e,i)?e:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(e,t){const i=this.getTileCacheForProjection(t);e>i.highWaterMark&&(i.highWaterMark=e)}useTile(e,t,i,s){}}class sn extends _t{constructor(e,t){super(e),this.tile=t}}const nn=tn;function yi(l,e){const t=/\{z\}/g,i=/\{x\}/g,s=/\{y\}/g,n=/\{-y\}/g;return function(r,o,h){if(r)return l.replace(t,r[0].toString()).replace(i,r[1].toString()).replace(s,r[2].toString()).replace(n,function(){const a=r[0],c=e.getFullTileRange(a);return Y(c,55),(c.getHeight()-r[2]-1).toString()})}}function Ei(l,e){const t=l.length,i=new Array(t);for(let s=0;s<t;++s)i[s]=yi(l[s],e);return Fi(i)}function Fi(l){return l.length===1?l[0]:function(e,t,i){if(!e)return;const s=$s(e),n=ke(s,l.length);return l[n](e,t,i)}}function rn(l,e,t){}function wi(l){const e=[];let t=/\{([a-z])-([a-z])\}/.exec(l);if(t){const i=t[1].charCodeAt(0),s=t[2].charCodeAt(0);let n;for(n=i;n<=s;++n)e.push(l.replace(t[0],String.fromCharCode(n)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(l),t){const i=parseInt(t[2],10);for(let s=parseInt(t[1],10);s<=i;s++)e.push(l.replace(t[0],s.toString()));return e}return e.push(l),e}const Mn=Object.freeze(Object.defineProperty({__proto__:null,createFromTemplate:yi,createFromTemplates:Ei,createFromTileUrlFunctions:Fi,expandUrl:wi,nullTileUrlFunction:rn},Symbol.toStringTag,{value:"Module"}));class Ct extends nn{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Ct.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,i=v(t),s=t.getState();let n;s==y.LOADING?(this.tileLoadingKeys_[i]=!0,n=et.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],n=s==y.ERROR?et.TILELOADERROR:s==y.LOADED?et.TILELOADEND:void 0),n!=null&&this.dispatchEvent(new sn(n,t))}setTileLoadFunction(e){this.tileCache.clear(),this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,this.tileCache.pruneExceptNewestZ(),typeof t<"u"?this.setKey(t):this.changed()}setUrl(e){const t=wi(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(Ei(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,i){}useTile(e,t,i){const s=Fe(e,t,i);this.tileCache.containsKey(s)&&this.tileCache.get(s)}}const on=Ct;class Pi extends on{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:an,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:hi,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const e in this.tileCacheForProjection)if(this.tileCacheForProjection[e].canExpireCache())return!0;return!1}expireCache(e,t){const i=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==i?t:{});for(const s in this.tileCacheForProjection){const n=this.tileCacheForProjection[s];n.expireCache(n==i?t:{})}}getGutterForProjection(e){return this.getProjection()&&e&&!ce(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getOpaque(e){return this.getProjection()&&e&&!ce(this.getProjection(),e)?!1:super.getOpaque(e)}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||ce(t,e)))return this.tileGrid;const i=v(e);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=xt(e)),this.tileGridForProjection[i]}getTileCacheForProjection(e){const t=this.getProjection();if(!t||ce(t,e))return this.tileCache;const i=v(e);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new fi(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]}createTile_(e,t,i,s,n,r){const o=[e,t,i],h=this.getTileCoordForTileUrlFunction(o,n),a=h?this.tileUrlFunction(h,s,n):void 0,c=new this.tileClass(o,a!==void 0?y.IDLE:y.EMPTY,a!==void 0?a:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=r,c.addEventListener(Z.CHANGE,this.handleTileChange.bind(this)),c}getTile(e,t,i,s,n){const r=this.getProjection();if(!r||!n||ce(r,n))return this.getTileInternal(e,t,i,s,r||n);const o=this.getTileCacheForProjection(n),h=[e,t,i];let a;const c=gi(h);o.containsKey(c)&&(a=o.get(c));const d=this.getKey();if(a&&a.key==d)return a;const u=this.getTileGridForProjection(r),f=this.getTileGridForProjection(n),g=this.getTileCoordForTileUrlFunction(h,n),_=new ht(r,u,n,f,h,g,this.getTilePixelRatio(s),this.getGutter(),(x,p,C,m)=>this.getTileInternal(x,p,C,m,r),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return _.key=d,a?(_.interimTile=a,_.refreshInterimChain(),o.replace(c,_)):o.set(c,_),_}getTileInternal(e,t,i,s,n){let r=null;const o=Fe(e,t,i),h=this.getKey();if(!this.tileCache.containsKey(o))r=this.createTile_(e,t,i,s,n,h),this.tileCache.set(o,r);else if(r=this.tileCache.get(o),r.key!=h){const a=r;r=this.createTile_(e,t,i,s,n,h),a.getState()==y.IDLE?r.interimTile=a.interimTile:r.interimTile=a,r.refreshInterimChain(),this.tileCache.replace(o,r)}return r}setRenderReprojectionEdges(e){if(this.renderReprojectionEdges_!=e){this.renderReprojectionEdges_=e;for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}}setTileGridForProjection(e,t){const i=ft(e);if(i){const s=v(i);s in this.tileGridForProjection||(this.tileGridForProjection[s]=t)}}clear(){super.clear();for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear()}}function an(l,e){l.getImage().src=e}const Dn=Object.freeze(Object.defineProperty({__proto__:null,default:Pi},Symbol.toStringTag,{value:"Module"}));class ln extends Pi{constructor(e){e=e||{};const t=e.projection!==void 0?e.projection:"EPSG:3857",i=e.tileGrid!==void 0?e.tileGrid:xi({extent:qe(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,opaque:e.opaque,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0}getGutter(){return this.gutter_}}const hn=ln,cn='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class un extends hn{constructor(e){e=e||{};let t;e.attributions!==void 0?t=e.attributions:t=[cn];const i=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",s=e.url!==void 0?e.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:t,attributionsCollapsible:!1,cacheSize:e.cacheSize,crossOrigin:i,interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:19,opaque:e.opaque!==void 0?e.opaque:!0,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:s,wrapX:e.wrapX,zDirection:e.zDirection})}}const bn=un;class Ke extends os{constructor(e,t,i){super(),i!==void 0&&t===void 0?this.setFlatCoordinates(i,e):(t=t||0,this.setCenterAndRadius(e,t,i))}clone(){const e=new Ke(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,s){const n=this.flatCoordinates,r=e-n[0],o=t-n[1],h=r*r+o*o;if(h<s){if(h===0)for(let a=0;a<this.stride;++a)i[a]=n[a];else{const a=this.getRadius()/Math.sqrt(h);i[0]=n[0]+a*r,i[1]=n[1]+a*o;for(let c=2;c<this.stride;++c)i[c]=n[c]}return i.length=this.stride,h}return s}containsXY(e,t){const i=this.flatCoordinates,s=e-i[0],n=t-i[1];return s*s+n*n<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,i=t[this.stride]-t[0];return Ue(t[0]-i,t[1]-i,t[0]+i,t[1]+i,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if(ct(e,t)){const i=this.getCenter();return e[0]<=i[0]&&e[2]>=i[0]||e[1]<=i[1]&&e[3]>=i[1]?!0:Qt(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,i=this.flatCoordinates[t]-this.flatCoordinates[0],s=e.slice();s[t]=s[0]+i;for(let n=1;n<t;++n)s[t+n]=e[n];this.setFlatCoordinates(this.layout,s),this.changed()}setCenterAndRadius(e,t,i){this.setLayout(i,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const s=this.flatCoordinates;let n=as(s,0,e,this.stride);s[n++]=s[0]+t;for(let r=1,o=this.stride;r<o;++r)s[n++]=s[r];s.length=n,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const i=this.getCenter(),s=this.getStride();this.setCenter(ls(i,0,i.length,s,e,t,i)),this.changed()}translate(e,t){const i=this.getCenter(),s=this.getStride();this.setCenter(hs(i,0,i.length,s,e,t,i)),this.changed()}}Ke.prototype.transform;const Si=Ke,ve={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};class Ie extends _t{constructor(e,t){super(e),this.feature=t}}function dn(l,e){const t=[];for(let i=0;i<e.length;++i){const n=e[i].getGeometry();Ri(l,n,t)}return t}function Me(l,e){return ai(l[0],l[1],e[0],e[1])}function ue(l,e){const t=l.length;return e<0?l[e+t]:e>=t?l[e-t]:l[e]}function De(l,e,t){let i,s;e<t?(i=e,s=t):(i=t,s=e);const n=Math.ceil(i),r=Math.floor(s);if(n>r){const h=de(l,i),a=de(l,s);return Me(h,a)}let o=0;if(i<n){const h=de(l,i),a=ue(l,n);o+=Me(h,a)}if(r<s){const h=ue(l,r),a=de(l,s);o+=Me(h,a)}for(let h=n;h<r-1;++h){const a=ue(l,h),c=ue(l,h+1);o+=Me(a,c)}return o}function Ri(l,e,t){if(e instanceof Ge){be(l,e.getCoordinates(),!1,t);return}if(e instanceof si){const i=e.getCoordinates();for(let s=0,n=i.length;s<n;++s)be(l,i[s],!1,t);return}if(e instanceof oi){const i=e.getCoordinates();for(let s=0,n=i.length;s<n;++s)be(l,i[s],!0,t);return}if(e instanceof ni){const i=e.getCoordinates();for(let s=0,n=i.length;s<n;++s){const r=i[s];for(let o=0,h=r.length;o<h;++o)be(l,r[o],!0,t)}return}if(e instanceof Ts){const i=e.getGeometries();for(let s=0;s<i.length;++s)Ri(l,i[s],t);return}}const tt={index:-1,endIndex:NaN};function gn(l,e,t,i){const s=l[0],n=l[1];let r=1/0,o=-1,h=NaN;for(let d=0;d<e.targets.length;++d){const u=e.targets[d],f=u.coordinates;let g=1/0,_;for(let x=0;x<f.length-1;++x){const p=f[x],C=f[x+1],m=Li(s,n,p,C);m.squaredDistance<g&&(g=m.squaredDistance,_=x+m.along)}g<r&&(r=g,u.ring&&e.targetIndex===d&&(u.endIndex>u.startIndex?_<u.startIndex&&(_+=f.length):u.endIndex<u.startIndex&&_>u.startIndex&&(_-=f.length)),h=_,o=d)}const a=e.targets[o];let c=a.ring;if(e.targetIndex===o&&c){const d=de(a.coordinates,h),u=t.getPixelFromCoordinate(d);Ye(u,e.startPx)>i&&(c=!1)}if(c){const d=a.coordinates,u=d.length,f=a.startIndex,g=h;if(f<g){const _=De(d,f,g);De(d,f,g-u)<_&&(h-=u)}else{const _=De(d,f,g);De(d,f,g+u)<_&&(h+=u)}}return tt.index=o,tt.endIndex=h,tt}function be(l,e,t,i){const s=l[0],n=l[1];for(let r=0,o=e.length-1;r<o;++r){const h=e[r],a=e[r+1],c=Li(s,n,h,a);if(c.squaredDistance===0){const d=r+c.along;i.push({coordinates:e,ring:t,startIndex:d,endIndex:d});return}}}const it={along:0,squaredDistance:0};function Li(l,e,t,i){const s=t[0],n=t[1],r=i[0],o=i[1],h=r-s,a=o-n;let c=0,d=s,u=n;return(h!==0||a!==0)&&(c=_e(((l-s)*h+(e-n)*a)/(h*h+a*a),0,1),d+=h*c,u+=a*c),it.along=c,it.squaredDistance=xs(ai(l,e,d,u),10),it}function de(l,e){const t=l.length;let i=Math.floor(e);const s=e-i;i>=t?i-=t:i<0&&(i+=t);let n=i+1;n>=t&&(n-=t);const r=l[i],o=r[0],h=r[1],a=l[n],c=a[0]-o,d=a[1]-h;return[o+c*s,h+d*s]}class fn extends ei{constructor(e){const t=e;t.stopDown||(t.stopDown=cs),super(t),this.on,this.once,this.un,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=mn(this.type_),this.stopClick_=!!e.stopClick,this.minPoints_=e.minPoints?e.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:us,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let i=e.geometryFunction;if(!i){const s=this.mode_;if(s==="Circle")i=function(n,r,o){const h=r||new Si([NaN,NaN]),a=b(n[0],o),c=Ee(a,b(n[n.length-1],o));h.setCenterAndRadius(a,Math.sqrt(c),this.geometryLayout_);const d=ne();return d&&h.transform(o,d),h};else{let n;s==="Point"?n=Ae:s==="LineString"?n=Ge:s==="Polygon"&&(n=oi),i=function(r,o,h){return o?s==="Polygon"?r[0].length?o.setCoordinates([r[0].concat([r[0][0]])],this.geometryLayout_):o.setCoordinates([],this.geometryLayout_):o.setCoordinates(r,this.geometryLayout_):o=new n(r,this.geometryLayout_),o}}}this.geometryFunction_=i,this.dragVertexDelay_=e.dragVertexDelay!==void 0?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new ti({source:new ii({useSpatialIndex:!1,wrapX:e.wrapX?e.wrapX:!1}),style:e.style?e.style:_n(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:ds,this.freehandCondition_,e.freehand?this.freehandCondition_=at:this.freehandCondition_=e.freehandCondition?e.freehandCondition:gs,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(fs.ACTIVE,this.updateState_)}setTrace(e){let t;e?e===!0?t=at:t=e:t=Cs,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(e){e.originalEvent.type===Z.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(e);let t=e.type===N.POINTERMOVE,i=!0;return!this.freehand_&&this.lastDragTime_&&e.type===N.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===N.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(e.coordinate),i=!1):this.freehand_&&e.type===N.POINTERDOWN?i=!1:t&&this.getPointerCount()<2?(i=e.type===N.POINTERMOVE,i&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):(e.originalEvent.pointerType==="mouse"||e.type===N.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(e)):e.type===N.DBLCLICK&&(i=!1),super.handleEvent(e)&&i}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new _s(N.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))},this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_();return}const t=this.getMap(),i=t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),s=t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),n=G([i,s]),r=this.traceSource_.getFeaturesInExtent(n);if(r.length===0)return;const o=dn(e.coordinate,r);o.length&&(this.traceState_={active:!0,startPx:e.pixel.slice(),targets:o,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const i=e.startIndex<=e.endIndex,s=e.startIndex<=t;i===s?i&&t>e.endIndex||!i&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(i&&t<e.endIndex||!i&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let i=0;if(e<t){const s=Math.ceil(e);let n=Math.floor(t);n===t&&(n-=1),i=n-s+1}else{const s=Math.floor(e);let n=Math.ceil(t);n===t&&(n+=1),i=s-n+1}i>0&&this.removeLastPoints_(i)}addTracedCoordinates_(e,t,i){if(t===i)return;const s=[];if(t<i){const n=Math.ceil(t);let r=Math.floor(i);r===i&&(r-=1);for(let o=n;o<=r;++o)s.push(ue(e.coordinates,o))}else{const n=Math.floor(t);let r=Math.ceil(i);r===i&&(r+=1);for(let o=n;o>=r;--o)s.push(ue(e.coordinates,o))}s.length&&this.appendCoordinates(s)}updateTrace_(e){const t=this.traceState_;if(!t.active||t.targetIndex===-1&&Ye(t.startPx,e.pixel)<this.snapTolerance_)return;const i=gn(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==i.index){if(t.targetIndex!==-1){const h=t.targets[t.targetIndex];this.removeTracedCoordinates_(h.startIndex,h.endIndex)}const o=t.targets[i.index];this.addTracedCoordinates_(o,o.startIndex,i.endIndex)}else{const o=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(o,i.endIndex)}t.targetIndex=i.index;const s=t.targets[t.targetIndex];s.endIndex=i.endIndex;const n=de(s.coordinates,s.endIndex),r=this.getMap().getPixelFromCoordinate(n);e.coordinate=n,e.pixel=[Math.round(r[0]),Math.round(r[1])]}handleUpEvent(e){let t=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const i=this.traceState_.active;if(this.toggleTraceState_(e),this.shouldHandle_){const s=!this.finishCoordinate_;s&&this.startDrawing_(e.coordinate),!s&&this.freehand_?this.finishDrawing():!this.freehand_&&(!s||this.mode_==="Point")&&(this.atFinish_(e.pixel,i)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,i=e.pixel,s=t[0]-i[0],n=t[1]-i[1],r=s*s+n*n;if(this.shouldHandle_=this.freehand_?r>this.squaredClickTolerance_:r<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(e.coordinate.slice());return}this.updateTrace_(e),this.modifyDrawing_(e.coordinate)}atFinish_(e,t){let i=!1;if(this.sketchFeature_){let s=!1,n=[this.finishCoordinate_];const r=this.mode_;if(r==="Point")i=!0;else if(r==="Circle")i=this.sketchCoords_.length===2;else if(r==="LineString")s=!t&&this.sketchCoords_.length>this.minPoints_;else if(r==="Polygon"){const o=this.sketchCoords_;s=o[0].length>this.minPoints_,n=[o[0][0],o[0][o[0].length-2]],t?n=[o[0][0]]:n=[o[0][0],o[0][o[0].length-2]]}if(s){const o=this.getMap();for(let h=0,a=n.length;h<a;h++){const c=n[h],d=o.getPixelFromCoordinate(c),u=e[0]-d[0],f=e[1]-d[1],g=this.freehand_?1:this.snapTolerance_;if(i=Math.sqrt(u*u+f*f)<=g,i){this.finishCoordinate_=c;break}}}}return i}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new se(new Ae(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new se);const t=e.getLinearRing(0);let i=this.sketchLine_.getGeometry();i?(i.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),i.changed()):(i=new Ge(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(i))}startDrawing_(e){const t=this.getMap().getView().getProjection(),i=Mt(this.geometryLayout_);for(;e.length<i;)e.push(0);this.finishCoordinate_=e,this.mode_==="Point"?this.sketchCoords_=e.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new se(new Ge(this.sketchLineCoords_)));const s=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new se,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(s),this.updateSketchFeatures_(),this.dispatchEvent(new Ie(ve.DRAWSTART,this.sketchFeature_))}modifyDrawing_(e){const t=this.getMap(),i=this.sketchFeature_.getGeometry(),s=t.getView().getProjection(),n=Mt(this.geometryLayout_);let r,o;for(;e.length<n;)e.push(0);this.mode_==="Point"?o=this.sketchCoords_:this.mode_==="Polygon"?(r=this.sketchCoords_[0],o=r[r.length-1],this.atFinish_(t.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(r=this.sketchCoords_,o=r[r.length-1]),o[0]=e[0],o[1]=e[1],this.geometryFunction_(this.sketchCoords_,i,s),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),i.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(i):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection();let s,n;const r=this.mode_;r==="LineString"||r==="Circle"?(this.finishCoordinate_=e.slice(),n=this.sketchCoords_,n.length>=this.maxPoints_&&(this.freehand_?n.pop():s=!0),n.push(e.slice()),this.geometryFunction_(n,t,i)):r==="Polygon"&&(n=this.sketchCoords_[0],n.length>=this.maxPoints_&&(this.freehand_?n.pop():s=!0),n.push(e.slice()),s&&(this.finishCoordinate_=n[0]),this.geometryFunction_(this.sketchCoords_,t,i)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),s&&this.finishDrawing()}removeLastPoints_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection(),s=this.mode_;for(let n=0;n<e;++n){let r;if(s==="LineString"||s==="Circle"){if(r=this.sketchCoords_,r.splice(-2,1),r.length>=2){this.finishCoordinate_=r[r.length-2].slice();const o=this.finishCoordinate_.slice();r[r.length-1]=o,this.createOrUpdateSketchPoint_(o)}this.geometryFunction_(r,t,i),t.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if(s==="Polygon"){r=this.sketchCoords_[0],r.splice(-2,1);const o=this.sketchLine_.getGeometry();if(r.length>=2){const h=r[r.length-2].slice();r[r.length-1]=h,this.createOrUpdateSketchPoint_(h)}o.setCoordinates(r),this.geometryFunction_(this.sketchCoords_,t,i)}if(r.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return;let t=this.sketchCoords_;const i=e.getGeometry(),s=this.getMap().getView().getProjection();this.mode_==="LineString"?(t.pop(),this.geometryFunction_(t,i,s)):this.mode_==="Polygon"&&(t[0].pop(),this.geometryFunction_(t,i,s),t=i.getCoordinates()),this.type_==="MultiPoint"?e.setGeometry(new ms([t])):this.type_==="MultiLineString"?e.setGeometry(new si([t])):this.type_==="MultiPolygon"&&e.setGeometry(new ni([t])),this.dispatchEvent(new Ie(ve.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e)}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new Ie(ve.DRAWABORT,e))}appendCoordinates(e){const t=this.mode_,i=!this.sketchFeature_;i&&this.startDrawing_(e[0]);let s;if(t==="LineString"||t==="Circle")s=this.sketchCoords_;else if(t==="Polygon")s=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;i&&s.shift(),s.pop();for(let r=0;r<e.length;r++)this.addToDrawing_(e[r]);const n=e[e.length-1];this.addToDrawing_(n),this.modifyDrawing_(n)}extend(e){const i=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=i.getCoordinates();const s=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=s.slice(),this.sketchCoords_.push(s.slice()),this.sketchPoint_=new se(new Ae(s)),this.updateSketchFeatures_(),this.dispatchEvent(new Ie(ve.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){const e=this.getMap(),t=this.getActive();(!e||!t)&&this.abortDrawing(),this.overlay_.setMap(t?e:null)}}function _n(){const l=ri();return function(e,t){return l[e.getGeometry().getType()]}}function kn(l,e){return function(t,i,s){const n=b(t[0],s),r=b(t[t.length-1],s),o=Math.sqrt(Ee(n,r));i=i||lt(new Si(n),l);let h=e;if(!e&&e!==0){const c=r[0]-n[0],d=r[1]-n[1];h=Math.atan2(d,c)}ps(i,n,o,h);const a=ne();return a&&i.transform(s,a),i}}function mn(l){switch(l){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+l)}}const On=fn,Yt=0,ye=1,Zt=[0,0,0,0],fe=[],st={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class nt extends _t{constructor(e,t,i){super(e),this.features=t,this.mapBrowserEvent=i}}class Tn extends ei{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:ys,this.defaultDeleteCondition_=function(i){return Es(i)&&Fs(i)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:at,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new ws,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new ti({source:new ii({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:Cn(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let t;if(e.features?t=e.features:e.source&&(this.source_=e.source,t=new Dt(this.source_.getFeatures()),this.source_.addEventListener(bt.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(bt.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(kt.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(kt.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}addFeature_(e){const t=e.getGeometry();if(t){const s=this.SEGMENT_WRITERS_[t.getType()];s&&s(e,t)}const i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,i),e.addEventListener(Z.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new Dt;const i=this.featuresBeingModified_.getArray();for(let s=0,n=t.length;s<n;++s){const r=t[s];for(let o=0,h=r.length;o<h;++o){const a=r[o].feature;a&&!i.includes(a)&&this.featuresBeingModified_.push(a)}}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new nt(st.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(Z.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,i=[];t.forEach(function(s){e===s.feature&&i.push(s)});for(let s=i.length-1;s>=0;--s){const n=i[s];for(let r=this.dragSegments_.length-1;r>=0;--r)this.dragSegments_[r][0]===n&&this.dragSegments_.splice(r,1);t.remove(n)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const i=t.getCoordinates(),s={feature:e,geometry:t,segment:[i,i]};this.rBush_.insert(t.getExtent(),s)}writeMultiPointGeometry_(e,t){const i=t.getCoordinates();for(let s=0,n=i.length;s<n;++s){const r=i[s],o={feature:e,geometry:t,depth:[s],index:s,segment:[r,r]};this.rBush_.insert(t.getExtent(),o)}}writeLineStringGeometry_(e,t){const i=t.getCoordinates();for(let s=0,n=i.length-1;s<n;++s){const r=i.slice(s,s+2),o={feature:e,geometry:t,index:s,segment:r};this.rBush_.insert(G(r),o)}}writeMultiLineStringGeometry_(e,t){const i=t.getCoordinates();for(let s=0,n=i.length;s<n;++s){const r=i[s];for(let o=0,h=r.length-1;o<h;++o){const a=r.slice(o,o+2),c={feature:e,geometry:t,depth:[s],index:o,segment:a};this.rBush_.insert(G(a),c)}}}writePolygonGeometry_(e,t){const i=t.getCoordinates();for(let s=0,n=i.length;s<n;++s){const r=i[s];for(let o=0,h=r.length-1;o<h;++o){const a=r.slice(o,o+2),c={feature:e,geometry:t,depth:[s],index:o,segment:a};this.rBush_.insert(G(a),c)}}}writeMultiPolygonGeometry_(e,t){const i=t.getCoordinates();for(let s=0,n=i.length;s<n;++s){const r=i[s];for(let o=0,h=r.length;o<h;++o){const a=r[o];for(let c=0,d=a.length-1;c<d;++c){const u=a.slice(c,c+2),f={feature:e,geometry:t,depth:[o,s],index:c,segment:u};this.rBush_.insert(G(u),f)}}}}writeCircleGeometry_(e,t){const i=t.getCenter(),s={feature:e,geometry:t,index:Yt,segment:[i,i]},n={feature:e,geometry:t,index:ye,segment:[i,i]},r=[s,n];s.featureSegments=r,n.featureSegments=r,this.rBush_.insert($e(i),s);let o=t;const h=ne();if(h&&this.getMap()){const a=this.getMap().getView().getProjection();o=o.clone().transform(h,a),o=lt(o).transform(a,h)}this.rBush_.insert(o.getExtent(),n)}writeGeometryCollectionGeometry_(e,t){const i=t.getGeometriesArray();for(let s=0;s<i.length;++s){const n=i[s],r=this.SEGMENT_WRITERS_[n.getType()];r(e,n)}}createOrUpdateVertexFeature_(e,t,i){let s=this.vertexFeature_;return s?s.getGeometry().setCoordinates(e):(s=new se(new Ae(e)),this.vertexFeature_=s,this.overlay_.getSource().addFeature(s)),s.set("features",t),s.set("geometries",i),s}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let t;return!e.map.getView().getInteracting()&&e.type==N.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=N.SINGLECLICK||!this.ignoreNextSingleClick_?t=this.removePoint():t=!0),e.type==N.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_);const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],i=[],s=[];for(let n=0,r=this.dragSegments_.length;n<r;++n){const o=this.dragSegments_[n],h=o[0],a=h.feature;i.includes(a)||i.push(a);const c=h.geometry;s.includes(c)||s.push(c);const d=h.depth;let u;const f=h.segment,g=o[1];for(;t.length<c.getStride();)t.push(f[g][t.length]);switch(c.getType()){case"Point":u=t,f[0]=t,f[1]=t;break;case"MultiPoint":u=c.getCoordinates(),u[h.index]=t,f[0]=t,f[1]=t;break;case"LineString":u=c.getCoordinates(),u[h.index+g]=t,f[g]=t;break;case"MultiLineString":u=c.getCoordinates(),u[d[0]][h.index+g]=t,f[g]=t;break;case"Polygon":u=c.getCoordinates(),u[d[0]][h.index+g]=t,f[g]=t;break;case"MultiPolygon":u=c.getCoordinates(),u[d[1]][d[0]][h.index+g]=t,f[g]=t;break;case"Circle":if(f[0]=t,f[1]=t,h.index===Yt)this.changingFeature_=!0,c.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0;const _=e.map.getView().getProjection();let x=Ye(b(c.getCenter(),_),b(t,_));const p=ne();if(p){const C=c.clone().transform(p,_);C.setRadius(x),x=C.transform(_,p).getRadius()}c.setRadius(x),this.changingFeature_=!1}break}u&&this.setGeometryCoordinates_(c,u)}this.createOrUpdateVertexFeature_(t,i,s)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate;this.handlePointerAtPixel_(e.pixel,e.map,t),this.dragSegments_.length=0,this.featuresBeingModified_=null;const i=this.vertexFeature_;if(i){const s=e.map.getView().getProjection(),n=[],r=i.getGeometry().getCoordinates(),o=G([r]),h=this.rBush_.getInExtent(o),a={};h.sort(xn);for(let c=0,d=h.length;c<d;++c){const u=h[c],f=u.segment;let g=v(u.geometry);const _=u.depth;if(_&&(g+="-"+_.join("-")),a[g]||(a[g]=new Array(2)),u.geometry.getType()==="Circle"&&u.index===ye){const x=qt(t,u,s);ie(x,r)&&!a[g][0]&&(this.dragSegments_.push([u,0]),a[g][0]=u);continue}if(ie(f[0],r)&&!a[g][0]){this.dragSegments_.push([u,0]),a[g][0]=u;continue}if(ie(f[1],r)&&!a[g][1]){if(a[g][0]&&a[g][0].index===0){let x=u.geometry.getCoordinates();switch(u.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":x=x[_[1]];case"Polygon":if(u.index!==x[_[0]].length-2)continue;break}}this.dragSegments_.push([u,1]),a[g][1]=u;continue}v(f)in this.vertexSegments_&&!a[g][0]&&!a[g][1]&&this.insertVertexCondition_(e)&&n.push(u)}n.length&&this.willModifyFeatures_(e,[n]);for(let c=n.length-1;c>=0;--c)this.insertVertex_(n[c],r)}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const i=this.dragSegments_[t][0],s=i.geometry;if(s.getType()==="Circle"){const n=s.getCenter(),r=i.featureSegments[0],o=i.featureSegments[1];r.segment[0]=n,r.segment[1]=n,o.segment[0]=n,o.segment[1]=n,this.rBush_.update($e(n),r);let h=s;const a=ne();if(a){const c=e.map.getView().getProjection();h=h.clone().transform(a,c),h=lt(h).transform(c,a)}this.rBush_.update(h.getExtent(),o)}else this.rBush_.update(G(i.segment),i)}return this.featuresBeingModified_&&(this.dispatchEvent(new nt(st.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map,e.coordinate)}handlePointerAtPixel_(e,t,i){const s=i||t.getCoordinateFromPixel(e),n=t.getView().getProjection(),r=function(a,c){return Wt(s,a,n)-Wt(s,c,n)};let o,h;if(this.hitDetection_){const a=typeof this.hitDetection_=="object"?c=>c===this.hitDetection_:void 0;t.forEachFeatureAtPixel(e,(c,d,u)=>{const f=u||c.getGeometry();if(f.getType()==="Point"&&c instanceof se&&this.features_.getArray().includes(c)){h=f;const g=h.getFlatCoordinates().slice(0,2);o=[{feature:c,geometry:h,segment:[g,g]}]}return!0},{layerFilter:a})}if(!o){const a=ot($e(s,Zt),n),c=t.getView().getResolution()*this.pixelTolerance_,d=Ps(Ss(a,c,Zt),n);o=this.rBush_.getInExtent(d)}if(o&&o.length>0){const a=o.sort(r)[0],c=a.segment;let d=qt(s,a,n);const u=t.getPixelFromCoordinate(d);let f=Ye(e,u);if(h||f<=this.pixelTolerance_){const g={};if(g[v(c)]=!0,this.snapToPointer_||(this.delta_[0]=d[0]-s[0],this.delta_[1]=d[1]-s[1]),a.geometry.getType()==="Circle"&&a.index===ye)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(d,[a.feature],[a.geometry]);else{const _=t.getPixelFromCoordinate(c[0]),x=t.getPixelFromCoordinate(c[1]),p=Ee(u,_),C=Ee(u,x);f=Math.sqrt(Math.min(p,C)),this.snappedToVertex_=f<=this.pixelTolerance_,this.snappedToVertex_&&(d=p>C?c[1]:c[0]),this.createOrUpdateVertexFeature_(d,[a.feature],[a.geometry]);const m={};m[v(a.geometry)]=!0;for(let T=1,E=o.length;T<E;++T){const F=o[T].segment;if(ie(c[0],F[0])&&ie(c[1],F[1])||ie(c[0],F[1])&&ie(c[1],F[0])){const P=v(o[T].geometry);P in m||(m[P]=!0,g[v(F)]=!0)}else break}}this.vertexSegments_=g;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const i=e.segment,s=e.feature,n=e.geometry,r=e.depth,o=e.index;let h;for(;t.length<n.getStride();)t.push(0);switch(n.getType()){case"MultiLineString":h=n.getCoordinates(),h[r[0]].splice(o+1,0,t);break;case"Polygon":h=n.getCoordinates(),h[r[0]].splice(o+1,0,t);break;case"MultiPolygon":h=n.getCoordinates(),h[r[1]][r[0]].splice(o+1,0,t);break;case"LineString":h=n.getCoordinates(),h.splice(o+1,0,t);break;default:return}this.setGeometryCoordinates_(n,h);const a=this.rBush_;a.remove(e),this.updateSegmentIndices_(n,o,r,1);const c={segment:[i[0],t],feature:s,geometry:n,depth:r,index:o};a.insert(G(c.segment),c),this.dragSegments_.push([c,1]);const d={segment:[t,i[1]],feature:s,geometry:n,depth:r,index:o+1};a.insert(G(d.segment),d),this.dragSegments_.push([d,0]),this.ignoreNextSingleClick_=!0}removePoint(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=N.POINTERDRAG){const e=this.lastPointerEvent_;this.willModifyFeatures_(e,this.dragSegments_);const t=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new nt(st.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null,t}return!1}removeVertex_(){const e=this.dragSegments_,t={};let i=!1,s,n,r,o,h,a,c,d,u,f,g;for(h=e.length-1;h>=0;--h)r=e[h],f=r[0],g=v(f.feature),f.depth&&(g+="-"+f.depth.join("-")),g in t||(t[g]={}),r[1]===0?(t[g].right=f,t[g].index=f.index):r[1]==1&&(t[g].left=f,t[g].index=f.index+1);for(g in t){switch(u=t[g].right,c=t[g].left,a=t[g].index,d=a-1,c!==void 0?f=c:f=u,d<0&&(d=0),o=f.geometry,n=o.getCoordinates(),s=n,i=!1,o.getType()){case"MultiLineString":n[f.depth[0]].length>2&&(n[f.depth[0]].splice(a,1),i=!0);break;case"LineString":n.length>2&&(n.splice(a,1),i=!0);break;case"MultiPolygon":s=s[f.depth[1]];case"Polygon":s=s[f.depth[0]],s.length>4&&(a==s.length-1&&(a=0),s.splice(a,1),i=!0,a===0&&(s.pop(),s.push(s[0]),d=s.length-1));break}if(i){this.setGeometryCoordinates_(o,n);const _=[];if(c!==void 0&&(this.rBush_.remove(c),_.push(c.segment[0])),u!==void 0&&(this.rBush_.remove(u),_.push(u.segment[1])),c!==void 0&&u!==void 0){const x={depth:f.depth,feature:f.feature,geometry:f.geometry,index:d,segment:_};this.rBush_.insert(G(x.segment),x)}this.updateSegmentIndices_(o,a,f.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return i}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,i,s){this.rBush_.forEachInExtent(e.getExtent(),function(n){n.geometry===e&&(i===void 0||n.depth===void 0||Rs(n.depth,i))&&n.index>t&&(n.index+=s)})}}function xn(l,e){return l.index-e.index}function Wt(l,e,t){const i=e.geometry;if(i.getType()==="Circle"){let n=i;if(e.index===ye){const r=ne();r&&(n=n.clone().transform(r,t));const o=Ee(n.getCenter(),b(l,t)),h=Math.sqrt(o)-n.getRadius();return h*h}}const s=b(l,t);return fe[0]=b(e.segment[0],t),fe[1]=b(e.segment[1],t),vs(s,fe)}function qt(l,e,t){const i=e.geometry;if(i.getType()==="Circle"&&e.index===ye){let n=i;const r=ne();return r&&(n=n.clone().transform(r,t)),Ot(n.getClosestPoint(b(l,t)),t)}const s=b(l,t);return fe[0]=b(e.segment[0],t),fe[1]=b(e.segment[1],t),Ot(Ls(s,fe),t)}function Cn(){const l=ri();return function(e,t){return l.Point}}const An=Tn,Kt=["fullscreenchange","webkitfullscreenchange","MSFullscreenChange"],Vt={ENTERFULLSCREEN:"enterfullscreen",LEAVEFULLSCREEN:"leavefullscreen"};class pn extends mt{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.on,this.once,this.un,this.keys_=e.keys!==void 0?e.keys:!1,this.source_=e.source,this.isInFullscreen_=!1,this.boundHandleMapTargetChange_=this.handleMapTargetChange_.bind(this),this.cssClassName_=e.className!==void 0?e.className:"ol-full-screen",this.documentListeners_=[],this.activeClassName_=e.activeClassName!==void 0?e.activeClassName.split(" "):[this.cssClassName_+"-true"],this.inactiveClassName_=e.inactiveClassName!==void 0?e.inactiveClassName.split(" "):[this.cssClassName_+"-false"];const t=e.label!==void 0?e.label:"⤢";this.labelNode_=typeof t=="string"?document.createTextNode(t):t;const i=e.labelActive!==void 0?e.labelActive:"×";this.labelActiveNode_=typeof i=="string"?document.createTextNode(i):i;const s=e.tipLabel?e.tipLabel:"Toggle full-screen";this.button_=document.createElement("button"),this.button_.title=s,this.button_.setAttribute("type","button"),this.button_.appendChild(this.labelNode_),this.button_.addEventListener(Z.CLICK,this.handleClick_.bind(this),!1),this.setClassName_(this.button_,this.isInFullscreen_),this.element.className=`${this.cssClassName_} ${Ze} ${Tt}`,this.element.appendChild(this.button_)}handleClick_(e){e.preventDefault(),this.handleFullScreen_()}handleFullScreen_(){const e=this.getMap();if(!e)return;const t=e.getOwnerDocument();if(Bt(t))if(Ht(t))En(t);else{let i;this.source_?i=typeof this.source_=="string"?t.getElementById(this.source_):this.source_:i=e.getTargetElement(),this.keys_?yn(i):vi(i)}}handleFullScreenChange_(){const e=this.getMap();if(!e)return;const t=this.isInFullscreen_;this.isInFullscreen_=Ht(e.getOwnerDocument()),t!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(At(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(Vt.ENTERFULLSCREEN)):(At(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(Vt.LEAVEFULLSCREEN)),e.updateSize())}setClassName_(e,t){t?(e.classList.remove(...this.inactiveClassName_),e.classList.add(...this.activeClassName_)):(e.classList.remove(...this.activeClassName_),e.classList.add(...this.inactiveClassName_))}setMap(e){const t=this.getMap();t&&t.removeChangeListener(Gt.TARGET,this.boundHandleMapTargetChange_),super.setMap(e),this.handleMapTargetChange_(),e&&e.addChangeListener(Gt.TARGET,this.boundHandleMapTargetChange_)}handleMapTargetChange_(){const e=this.documentListeners_;for(let i=0,s=e.length;i<s;++i)ze(e[i]);e.length=0;const t=this.getMap();if(t){const i=t.getOwnerDocument();Bt(i)?this.element.classList.remove(Nt):this.element.classList.add(Nt);for(let s=0,n=Kt.length;s<n;++s)e.push(Xe(i,Kt[s],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}}}function Bt(l){const e=l.body;return!!(e.webkitRequestFullscreen||e.requestFullscreen&&l.fullscreenEnabled)}function Ht(l){return!!(l.webkitIsFullScreen||l.fullscreenElement)}function vi(l){l.requestFullscreen?l.requestFullscreen():l.webkitRequestFullscreen&&l.webkitRequestFullscreen()}function yn(l){l.webkitRequestFullscreen?l.webkitRequestFullscreen():vi(l)}function En(l){l.exitFullscreen?l.exitFullscreen():l.webkitExitFullscreen&&l.webkitExitFullscreen()}const Gn=pn,pe={VERTICAL:0,HORIZONTAL:1};class Fn extends mt{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render}),this.dragListenerKeys_=[],this.currentResolution_=void 0,this.direction_=pe.VERTICAL,this.dragging_,this.heightLimit_=0,this.widthLimit_=0,this.startX_,this.startY_,this.thumbSize_=null,this.sliderInitialized_=!1,this.duration_=e.duration!==void 0?e.duration:200;const t=e.className!==void 0?e.className:"ol-zoomslider",i=document.createElement("button");i.setAttribute("type","button"),i.className=t+"-thumb "+Ze;const s=this.element;s.className=t+" "+Ze+" "+Tt,s.appendChild(i),s.addEventListener(Ce.POINTERDOWN,this.handleDraggerStart_.bind(this),!1),s.addEventListener(Ce.POINTERMOVE,this.handleDraggerDrag_.bind(this),!1),s.addEventListener(Ce.POINTERUP,this.handleDraggerEnd_.bind(this),!1),s.addEventListener(Z.CLICK,this.handleContainerClick_.bind(this),!1),i.addEventListener(Z.CLICK,Is,!1)}setMap(e){super.setMap(e),e&&e.render()}initSlider_(){const e=this.element;let t=e.offsetWidth,i=e.offsetHeight;if(t===0&&i===0)return this.sliderInitialized_=!1;const s=getComputedStyle(e);t-=parseFloat(s.paddingRight)+parseFloat(s.paddingLeft),i-=parseFloat(s.paddingTop)+parseFloat(s.paddingBottom);const n=e.firstElementChild,r=getComputedStyle(n),o=n.offsetWidth+parseFloat(r.marginRight)+parseFloat(r.marginLeft),h=n.offsetHeight+parseFloat(r.marginTop)+parseFloat(r.marginBottom);return this.thumbSize_=[o,h],t>i?(this.direction_=pe.HORIZONTAL,this.widthLimit_=t-o):(this.direction_=pe.VERTICAL,this.heightLimit_=i-h),this.sliderInitialized_=!0}handleContainerClick_(e){const t=this.getMap().getView(),i=this.getRelativePosition_(e.offsetX-this.thumbSize_[0]/2,e.offsetY-this.thumbSize_[1]/2),s=this.getResolutionForPosition_(i),n=t.getConstrainedZoom(t.getZoomForResolution(s));t.animateInternal({zoom:n,duration:this.duration_,easing:Ms})}handleDraggerStart_(e){if(!this.dragging_&&e.target===this.element.firstElementChild){const t=this.element.firstElementChild;if(this.getMap().getView().beginInteraction(),this.startX_=e.clientX-parseFloat(t.style.left),this.startY_=e.clientY-parseFloat(t.style.top),this.dragging_=!0,this.dragListenerKeys_.length===0){const i=this.handleDraggerDrag_,s=this.handleDraggerEnd_,n=this.getMap().getOwnerDocument();this.dragListenerKeys_.push(Xe(n,Ce.POINTERMOVE,i,this),Xe(n,Ce.POINTERUP,s,this))}}}handleDraggerDrag_(e){if(this.dragging_){const t=e.clientX-this.startX_,i=e.clientY-this.startY_,s=this.getRelativePosition_(t,i);this.currentResolution_=this.getResolutionForPosition_(s),this.getMap().getView().setResolution(this.currentResolution_)}}handleDraggerEnd_(e){this.dragging_&&(this.getMap().getView().endInteraction(),this.dragging_=!1,this.startX_=void 0,this.startY_=void 0,this.dragListenerKeys_.forEach(ze),this.dragListenerKeys_.length=0)}setThumbPosition_(e){const t=this.getPositionForResolution_(e),i=this.element.firstElementChild;this.direction_==pe.HORIZONTAL?i.style.left=this.widthLimit_*t+"px":i.style.top=this.heightLimit_*t+"px"}getRelativePosition_(e,t){let i;return this.direction_===pe.HORIZONTAL?i=e/this.widthLimit_:i=t/this.heightLimit_,_e(i,0,1)}getResolutionForPosition_(e){return this.getMap().getView().getResolutionForValueFunction()(1-e)}getPositionForResolution_(e){const t=this.getMap().getView().getValueForResolutionFunction();return _e(1-t(e),0,1)}render(e){if(!e.frameState||!this.sliderInitialized_&&!this.initSlider_())return;const t=e.frameState.viewState.resolution;this.currentResolution_=t,this.setThumbPosition_(t)}}const Nn=Fn;class wn extends mt{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.extent=e.extent?e.extent:null;const t=e.className!==void 0?e.className:"ol-zoom-extent",i=e.label!==void 0?e.label:"E",s=e.tipLabel!==void 0?e.tipLabel:"Fit to extent",n=document.createElement("button");n.setAttribute("type","button"),n.title=s,n.appendChild(typeof i=="string"?document.createTextNode(i):i),n.addEventListener(Z.CLICK,this.handleClick_.bind(this),!1);const r=t+" "+Ze+" "+Tt,o=this.element;o.className=r,o.appendChild(n)}handleClick_(e){e.preventDefault(),this.handleZoomToExtent()}handleZoomToExtent(){const t=this.getMap().getView(),i=this.extent?this.extent:t.getProjection().getExtent();t.fitInternal(Ds(i))}}const jn=wn;export{cn as A,Rn as B,Dn as C,On as D,Ns as E,Gn as F,Ln as G,In as H,hi as I,Mn as J,Ks as K,di as L,An as M,Le as N,bn as O,Bs as T,on as U,hn as X,Nn as Z,jn as a,Pi as b,kn as c,xi as d,qe as e,Fi as f,Ut as g,li as h,Ys as i,zs as j,ge as k,nn as l,sn as m,xt as n,fi as o,Fe as p,et as q,Zs as r,_i as s,wi as t,zt as u,$s as v,Ei as w,rn as x,Hs as y,vn as z};

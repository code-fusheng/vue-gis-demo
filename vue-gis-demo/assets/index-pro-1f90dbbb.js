import{_ as N,r as M,b as w,o as v,c as k,d as n,w as i,n as z,F as _,f as I,u as A,e as d,t as f,k as R,p as j,g as O,a as U}from"./index-93f5143b.js";import{S as p,F as L,e as S,T as x,C as q,cx as B,cy as J,V as Y,M as D,cp as X,b as c,d as m,G as b,k as Z,h as C,j as Q,P as E,cq as F}from"./Select-f529c55d.js";import{b as W,c as K}from"./Image-3f1e9e5f.js";import"./index-820b305b.js";const ee=[{label:"EPSG:3857(大坐标)",value:"EPSG:3857",state:!0},{label:"EPSG:4326(小坐标)",value:"EPSG:4326",state:!0},{label:"EPSG:4490(中国大地2000)",value:"EPSG:4490",state:!1}],G={"HTC-轮廓":[new p({fill:new L({color:"#ff5900"}),stroke:new S({color:"#ff5900",width:1.5})})],"HTC-停车位":[new p({fill:new L({color:"#56bacc"}),stroke:new S({color:"#988a8a",width:.5})})],"HTC-车位号":[new p({text:new x({font:"bold 5px Arial",fill:new L({color:"#485759"}),text:"",textAlign:"center",rotation:-Math.PI/2})})],"HTC-文字":[new p({text:new x({font:"bold 12px Arial",fill:new L({color:"#879294"}),text:"",textAlign:"center"})})],"HTC-标识":[new p({image:new q({radius:5,fill:new L({color:"rgba(255, 255, 255, 0.4)"}),stroke:new S({color:"#3399CC",width:.5})}),fill:new L({color:"rgba(255, 255, 255, 0.4)"}),stroke:new S({color:"#3399CC",width:.5})})]},H=function(a,t){var{Text:e,Layer:o}=JSON.parse(a.values_.properties);if(a.getGeometry().getType(),e&&o!="HTC-车位号"){var l=G[o]||[new p({fill:B,stroke:J})];return l[0].getText().setText(e),l}return G[o]};const te=a=>(j("data-v-9ef968c6"),a=a(),O(),a),ae=te(()=>U("div",{id:"map",tabindex:"0",class:"map"},null,-1)),$=M("A2-001"),V=M(""),T=M(""),P=M("EPSG:4326"),re={data(){return{key:"",mapInfoList:[],currentMapInfoList:[],currentMapInfo:{},startToEnd:[],map:"",view:"",tileLayer:"",vectorLayer:"",parkLayer:"",markLayer:"",roadLayer:"",shortestRoadLayer:"",startLayer:"",endLayer:"",carLayer:"",carStyleLayer:"",showMarkSwitch:!1,showRoadSwitch:!1,checkRoadSwitch:!1,showCarSwitch:!1,showSelectTipSwitch:!1,showHoverTipSwitch:!1,carSelect:""}},methods:{printMapInfo(){console.table({坐标系:this.view.getProjection().getCode(),深度:this.view.getZoom(),分辨率:this.view.getResolution(),图层数:this.map.getLayers().getLength()}),console.log(this.view)},initView(){this.view=new Y({projection:"EPSG:4326",center:[0,0],zoom:1})},initMap(){this.map=new D({target:"map",controls:[],interactions:X(),layers:[],view:this.view})},listMap(){var a={layerType:"base"};z.post("http://42.192.222.62:10010/mapinfo/page",a).then(t=>{console.log(t.data),this.mapInfoList=t.data.data})},changeMap(a){console.log(a),this.currentMapInfoList=this.mapInfoList.filter(s=>s.park_name==a),this.currentMapInfo=this.currentMapInfoList[0],T.value=this.currentMapInfo.layer_level,console.table(this.currentMapInfo);var{layer_name:t,extent:e,center:o}=this.currentMapInfo,l=t.toLowerCase();this.parkLayer=new c({source:new m({format:new b,url:`http://42.192.222.62:8080/geoserver/wfs?version=1.1.0&request=GetFeature&typeName=park_map:${l}&outputFormat=application/json&srsname=EPSG:4326`}),style:H}),this.map.addLayer(this.parkLayer),this.view.setZoom(11.786666666666667),this.view.setCenter([116.09564230861724,38.9752956321172]),this.view.setRotation(Math.PI/2),this.map.render()},changeLevel(){},changeCoordinateType(){},doLoadMark(){if(this.showMarkSwitch=!this.showMarkSwitch,this.showMarkSwitch){var{layer_key:a,layer_level:t,layer_name:e,extent:o,center:l}=this.currentMapInfo,s=(a+"_"+t+"_mark").toLowerCase();this.markLayer=new c({source:new m({format:new b,url:`http://42.192.222.62:8080/geoserver/wfs?version=1.1.0&request=GetFeature&typeName=park_map:${s}&outputFormat=application/json&srsname=EPSG:4326`}),style:H}),this.map.addLayer(this.markLayer),console.log(this.markLayer.getStyle())}else this.map.removeLayer(this.markLayer)},doLoadRoad(){if(this.showRoadSwitch=!this.showRoadSwitch,this.showRoadSwitch){var{layer_key:a,layer_level:t,layer_name:e,extent:o,center:l}=this.currentMapInfo,s=(a+"_"+t+"_road").toLowerCase();this.roadLayer=new c({source:new m({format:new b,url:`http://42.192.222.62:8080/geoserver/wfs?version=1.1.0&request=GetFeature&typeName=park_map:${s}&outputFormat=application/json&srsname=EPSG:4326`})}),this.map.addLayer(this.roadLayer)}else this.map.removeLayer(this.roadLayer)},doLoadCarStyle(){if(console.log("doLoadCarStyle"),this.showCarSwitch=!this.showCarSwitch,this.showCarSwitch){this.carStyleLayer=new c({source:new m});var a=this.parkLayer.getSource().getFeatures();a.forEach(t=>{var{Text:e,Layer:o}=JSON.parse(t.values_.properties);if(o==="HTC-停车位"){var l=t.getGeometry().getCoordinates(),s=new Z([l]),h=new C({geometry:s});h.setStyle(G[o]),this.carStyleLayer.getSource().addFeature(h)}}),this.map.addLayer(this.carStyleLayer)}else this.map.removeLayer(this.carStyleLayer)},doHoverShowTip(){if(this.showHoverTipSwitch=!this.showHoverTipSwitch,this.showHoverTipSwitch){var a=t=>{};this.map.on("pointermove",a)}},doSelectShowTip(){if(this.showSelectTipSwitch=!this.showSelectTipSwitch,this.showSelectTipSwitch){const t=new p({stroke:new S({color:"red",width:.5}),text:new x({font:"bold 5px Arial",fill:new L({color:"#485759"}),text:"",textAlign:"center",rotation:-Math.PI/2})});this.carSelect=new Q({style:t,pixelTolerance:50}),this.map.addInteraction(this.carSelect);var a=e=>{var o=e.selected[0];o.setStyle(t)};this.carSelect.on("select",a)}else this.carSelect.un("select",a)},doCheckStartToEnd(){if(this.checkRoadSwitch=!this.checkRoadSwitch,this.checkRoadSwitch){var a=t=>{var e=t.coordinate;this.startToEnd.push(e);var o=new C({geometry:new E(e)});o.setStyle(new p({image:new F({src:"../定位.png",anchor:[.5,1]})})),this.startToEnd.length==1?(this.startLayer=new c({source:new m}),this.startLayer.getSource().addFeature(o),this.map.addLayer(this.startLayer)):this.startToEnd.length==2?(this.endLayer=new c({source:new m}),this.endLayer.getSource().addFeature(o),this.map.addLayer(this.endLayer)):(this.startToEnd=[],this.map.removeLayer(this.shortestRoadLayer),this.map.removeLayer(this.startLayer),this.map.removeLayer(this.endLayer),this.map.removeLayer(this.carLayer),this.startLayer="",this.endLayer="")};this.map.on("singleclick",a)}else this.map.un("singleclick",a),this.startToEnd=[],this.map.removeLayer(this.shortestRoadLayer),this.map.removeLayer(this.startLayer),this.map.removeLayer(this.endLayer),this.map.removeLayer(this.carLayer),this.startLayer="",this.endLayer=""},doLoadShortestRoad(){var a=this.startToEnd[0],t=this.startToEnd[1],e=["x1:"+a[0],"y1:"+a[1],"x2:"+t[0],"y2:"+t[1]];const o={LAYERS:"park_map:load_road_shortest",VERSION:"1.1.0",REQUEST:"GetMap",FORMAT:"image/png",exceptions:"application/vnd.ogc.se_inimage"};o.viewparams=e.join(";"),this.shortestRoadLayer=new W({source:new K({url:"http://42.192.222.62:8080/geoserver/wms",params:o})}),this.map.addLayer(this.shortestRoadLayer),this.map.render()},async doLoadCarRoad(){var a=[];await z.post(`http://42.192.222.62:10010/slotinfo?layer_level=${this.currentMapInfo.layer_level}&layer_key=${this.currentMapInfo.layer_key}&slot_num=${$.value}`).then(e=>{console.log(e.data),a=e.data.data}).catch(function(e){console.log(e),alert("未找到")}),this.carLayer=new c({source:new m});var t=new C({geometry:new E(a)});t.setStyle(new p({image:new F({src:"../定位.png",anchor:[0,0]})})),this.carLayer.getSource().addFeature(t),this.map.addLayer(this.carLayer),this.map.render(),this.startToEnd.push(a)},doTestRandomStart(){var{layer_key:a,layer_level:t,layer_name:e,extent:o,center:u}=this.currentMapInfo;console.log(o);var l=o.replace(/[()]/g,"").split(","),s=parseFloat(l[0]),h=parseFloat(l[2]),g=parseFloat(l[1]),y=parseFloat(l[3]),u=[parseFloat((Math.random()*(g-s)+s).toFixed(12)),parseFloat((Math.random()*(y-h)+h).toFixed(12))];console.log(u),this.startToEnd.push(u);var r=new C({geometry:new E(u)});r.setStyle(new p({image:new F({src:"../定位.png",anchor:[.5,1]})})),this.startLayer=new c({source:new m}),this.startLayer.getSource().addFeature(r),this.map.addLayer(this.startLayer),this.map.render()},doFastLoadCarRoad(){this.showCarSwitch=!1,this.showMarkSwitch=!1,this.startToEnd=[],this.map.removeLayer(this.shortestRoadLayer),this.map.removeLayer(this.startLayer),this.map.removeLayer(this.endLayer),this.map.removeLayer(this.carLayer),this.map.removeLayer(this.shortestRoadLayer),this.map.removeLayer(this.carStyleLayer),this.map.removeLayer(this.parkLayer),this.map.removeLayer(this.markLayer),this.changeMap("华熙LIVE·五棵松"),this.currentMapInfo;var a=!1;this.map.on("rendercomplete",t=>{if(!a){this.doLoadCarStyle(),a=!a;var e=!1;this.map.on("rendercomplete",o=>{if(!e){this.doLoadMark(),e=!e;var l=!1;this.map.on("rendercomplete",s=>{if(!l){this.doTestRandomStart(),l=!l;var h=!1;this.map.on("rendercomplete",g=>{if(!h){this.doLoadCarRoad(),h=!h;var y=!1;this.map.on("rendercomplete",u=>{y||(this.doLoadShortestRoad(),y=!y)})}})}})}})}})}},mounted(){this.listMap(),this.initView(),this.initMap()}},oe=Object.assign(re,{__name:"index-pro",setup(a){return(t,e)=>{const o=w("el-option"),l=w("el-select"),s=w("el-button"),h=w("el-input"),g=w("a-layout-header"),y=w("a-layout-content"),u=w("a-layout");return v(),k("div",null,[n(u,null,{default:i(()=>[n(g,null,{default:i(()=>[n(l,{style:{width:"120px"},onChange:e[0]||(e[0]=r=>t.changeCoordinateType(P.value)),modelValue:P.value,"onUpdate:modelValue":e[1]||(e[1]=r=>P.value=r),placeholder:"Select",size:"small"},{default:i(()=>[(v(!0),k(_,null,I(A(ee),r=>(v(),R(o,{key:r.value,label:r.label,value:r.value,disabled:!r.state},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"]),n(l,{modelValue:V.value,"onUpdate:modelValue":e[2]||(e[2]=r=>V.value=r),placeholder:"请选择车场地图",size:"small",onChange:e[3]||(e[3]=r=>t.changeMap(V.value))},{default:i(()=>[(v(!0),k(_,null,I(t.mapInfoList,r=>(v(),R(o,{key:r.layer_name,label:r.park_name,value:r.park_name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),n(l,{style:{width:"100px"},modelValue:T.value,"onUpdate:modelValue":e[4]||(e[4]=r=>T.value=r),placeholder:"请选择楼层",size:"small",onChange:e[5]||(e[5]=r=>t.changeLevel(T.value)),disabled:t.currentMapInfoList.length==0},{default:i(()=>[(v(!0),k(_,null,I(t.currentMapInfoList,r=>(v(),R(o,{key:r.layer_name,label:r.layer_level,value:r.layer_name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),n(s,{size:"small",onClick:e[6]||(e[6]=r=>t.printMapInfo())},{default:i(()=>[d("调试")]),_:1}),n(s,{size:"small",onClick:e[7]||(e[7]=r=>t.doLoadMark())},{default:i(()=>[d(f(t.showMarkSwitch?"隐藏标注":"显示标注"),1)]),_:1}),n(s,{size:"small",onClick:e[8]||(e[8]=r=>t.doLoadRoad())},{default:i(()=>[d(f(t.showRoadSwitch?"隐藏道路":"显示道路"),1)]),_:1}),n(s,{size:"small",onClick:e[9]||(e[9]=r=>t.doLoadCarStyle())},{default:i(()=>[d(f(t.showCarSwitch?"隐藏车位渲染":"显示车位渲染"),1)]),_:1}),n(s,{size:"small",onClick:e[10]||(e[10]=r=>t.doSelectShowTip())},{default:i(()=>[d(f(t.showSelectTipSwitch?"关闭选中提示":"开启选中提示"),1)]),_:1}),n(s,{size:"small",onClick:e[11]||(e[11]=r=>t.doHoverShowTip())},{default:i(()=>[d(f(t.showHoverTipSwitch?"关闭悬浮提示":"开启悬浮提示"),1)]),_:1}),n(s,{size:"small",onClick:e[12]||(e[12]=r=>t.doCheckStartToEnd())},{default:i(()=>[d(f(t.checkRoadSwitch?"关闭选点":"开启选点"),1)]),_:1}),n(s,{size:"small",onClick:e[13]||(e[13]=r=>t.doLoadShortestRoad()),disabled:t.startToEnd.length!=2},{default:i(()=>[d("计算路径 ")]),_:1},8,["disabled"]),n(h,{placeholder:"请输入车位编号",size:"small",style:{width:"200px"},modelValue:$.value,"onUpdate:modelValue":e[14]||(e[14]=r=>$.value=r)},null,8,["modelValue"]),n(s,{size:"small",onClick:e[15]||(e[15]=r=>t.doLoadCarRoad())},{default:i(()=>[d("导航 ")]),_:1}),n(s,{size:"small",onClick:e[16]||(e[16]=r=>t.doFastLoadCarRoad())},{default:i(()=>[d("一键导航 ")]),_:1})]),_:1}),n(y,null,{default:i(()=>[ae]),_:1})]),_:1})])}}}),he=N(oe,[["__scopeId","data-v-9ef968c6"]]);export{he as default};

import{bl as se,s as $,be as B,bs as K,w as ie,x as ne,bm as u,R as O,U as x,z as ae,A as re,m as Q,D as oe,E as ce,af as ge,a8 as he,ag as G,a3 as ue,o as le,a as de,bu as _e,cu as D,ab as U,aa as T,bj as J,cv as V,bk as me,a4 as H,bv as Ie,L as Ee,J as Re,W,c5 as z,cw as fe,N as pe,O as Se,Z as Y,$ as Oe,_ as xe,a2 as ve}from"./Select-f529c55d.js";class Ae extends se{constructor(e,t,s,n,i,r,o){const a=e.getExtent(),c=t.getExtent(),g=c?$(s,c):s,I=B(g),d=K(e,t,I,n),_=ie,E=new ne(e,t,g,a,d*_,n),v=E.calculateSourceExtent(),m=r(v,d,i),f=m?u.IDLE:u.EMPTY,p=m?m.getPixelRatio():1;super(s,n,p,f),this.targetProj_=t,this.maxSourceExtent_=a,this.triangulation_=E,this.targetResolution_=n,this.targetExtent_=s,this.sourceImage_=m,this.sourcePixelRatio_=p,this.interpolate_=o,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==u.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(e==u.LOADED){const t=O(this.targetExtent_)/this.targetResolution_,s=x(this.targetExtent_)/this.targetResolution_;this.canvas_=ae(t,s,this.sourcePixelRatio_,this.sourceImage_.getResolution(),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_)}this.state=e,this.changed()}load(){if(this.state==u.IDLE){this.state=u.LOADING,this.changed();const e=this.sourceImage_.getState();e==u.LOADED||e==u.ERROR?this.reproject_():(this.sourceListenerKey_=re(this.sourceImage_,Q.CHANGE,function(t){const s=this.sourceImage_.getState();(s==u.LOADED||s==u.ERROR)&&(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}}unlistenSource_(){oe(this.sourceListenerKey_),this.sourceListenerKey_=null}}const Le=Ae,j={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class X extends ce{constructor(e,t){super(e),this.image=t}}class Z extends ge{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:e.interpolate!==void 0?e.interpolate:!0}),this.on,this.once,this.un,this.resolutions_=e.resolutions!==void 0?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const t=this.getResolutions();if(t){const s=he(t,e,0);e=t[s]}return e}getImage(e,t,s,n){const i=this.getProjection();if(!i||!n||G(i,n))return i&&(n=i),this.getImageInternal(e,t,s,n);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&G(this.reprojectedImage_.getProjection(),n)&&this.reprojectedImage_.getResolution()==t&&ue(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new Le(i,n,e,t,s,(r,o,a)=>this.getImageInternal(r,o,a,i),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,t,s,n){return le()}handleImageChange(e){const t=e.target;let s;switch(t.getState()){case u.LOADING:this.loading=!0,s=j.IMAGELOADSTART;break;case u.LOADED:this.loading=!1,s=j.IMAGELOADEND;break;case u.ERROR:this.loading=!1,s=j.IMAGELOADERROR;break;default:return}this.hasListener(s)&&this.dispatchEvent(new X(s,t))}}function ee(h,e){h.getImage().src=e}const Ne=Object.freeze(Object.defineProperty({__proto__:null,ImageSourceEvent:X,ImageSourceEventType:j,default:Z,defaultImageLoadFunction:ee},Symbol.toStringTag,{value:"Module"}));function q(h,e){const t=[];Object.keys(e).forEach(function(n){e[n]!==null&&e[n]!==void 0&&t.push(n+"="+encodeURIComponent(e[n]))});const s=t.join("&");return h=h.replace(/[?&]$/,""),h+=h.includes("?")?"&":"?",h+s}const b="1.3.0",R=4,k=[101,101];class ye extends Z{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:ee,this.params_=Object.assign({},e.params),this.v13_=!0,this.updateV13_(),this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.image_=null,this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5}getFeatureInfoUrl(e,t,s,n){if(this.url_===void 0)return;const i=de(s),r=this.getProjection();r&&r!==i&&(t=K(r,i,e,t),e=_e(e,i,r));const o=D(e,t,0,k),a={SERVICE:"WMS",VERSION:b,REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};Object.assign(a,this.params_,n);const c=U((e[0]-o[0])/t,R),g=U((o[3]-e[1])/t,R);return a[this.v13_?"I":"X"]=c,a[this.v13_?"J":"Y"]=g,this.getRequestUrl_(o,k,1,r||i,a)}getLegendUrl(e,t){if(this.url_===void 0)return;const s={SERVICE:"WMS",VERSION:b,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(t===void 0||t.LAYER===void 0){const n=this.params_.LAYERS;if(!(!Array.isArray(n)||n.length===1))return;s.LAYER=n}if(e!==void 0){const n=this.getProjection()?this.getProjection().getMetersPerUnit():1,i=28e-5;s.SCALE=e*n/i}return Object.assign(s,t),q(this.url_,s)}getParams(){return this.params_}getImageInternal(e,t,s,n){if(this.url_===void 0)return null;t=this.findNearestResolution(t),s!=1&&(!this.hidpi_||this.serverType_===void 0)&&(s=1);const i=t/s,r=B(e),o=T(O(e)/i,R),a=T(x(e)/i,R),c=D(r,i,0,[o,a]),g=T(this.ratio_*O(e)/i,R),I=T(this.ratio_*x(e)/i,R),d=D(r,i,0,[g,I]),_=this.image_;if(_&&this.renderedRevision_==this.getRevision()&&_.getResolution()==t&&_.getPixelRatio()==s&&J(_.getExtent(),c))return _;const E={SERVICE:"WMS",VERSION:b,REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};Object.assign(E,this.params_),this.imageSize_[0]=V(O(d)/i,R),this.imageSize_[1]=V(x(d)/i,R);const v=this.getRequestUrl_(d,this.imageSize_,s,n,E);return this.image_=new me(d,t,s,v,this.crossOrigin_,this.imageLoadFunction_),this.renderedRevision_=this.getRevision(),this.image_.addEventListener(Q.CHANGE,this.handleImageChange.bind(this)),this.image_}getImageLoadFunction(){return this.imageLoadFunction_}getRequestUrl_(e,t,s,n,i){if(H(this.url_!==void 0,9),i[this.v13_?"CRS":"SRS"]=n.getCode(),"STYLES"in this.params_||(i.STYLES=""),s!=1)switch(this.serverType_){case"geoserver":const a=90*s+.5|0;"FORMAT_OPTIONS"in i?i.FORMAT_OPTIONS+=";dpi:"+a:i.FORMAT_OPTIONS="dpi:"+a;break;case"mapserver":i.MAP_RESOLUTION=90*s;break;case"carmentaserver":case"qgis":i.DPI=90*s;break;default:H(!1,8);break}i.WIDTH=t[0],i.HEIGHT=t[1];const r=n.getAxisOrientation();let o;return this.v13_&&r.substr(0,2)=="ne"?o=[e[1],e[0],e[3],e[2]]:o=e,i.BBOX=o.join(","),q(this.url_,i)}getUrl(){return this.url_}setImageLoadFunction(e){this.image_=null,this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.image_=null,this.changed())}updateParams(e){Object.assign(this.params_,e),this.updateV13_(),this.image_=null,this.changed()}updateV13_(){const e=this.params_.VERSION||b;this.v13_=Ie(e,"1.3")>=0}}const Te=ye,Fe=Object.freeze(Object.defineProperty({__proto__:null,default:Te},Symbol.toStringTag,{value:"Module"}));class be extends Ee{constructor(e){e=e||{},super(e)}}const je=be;class Me extends Re{constructor(e){super(e),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(e){const t=e.layerStatesArray[e.layerIndex],s=e.pixelRatio,n=e.viewState,i=n.resolution,r=this.getLayer().getSource(),o=e.viewHints;let a=e.extent;if(t.extent!==void 0&&(a=$(a,W(t.extent,n.projection))),!o[z.ANIMATING]&&!o[z.INTERACTING]&&!fe(a))if(r){const c=n.projection,g=r.getImage(a,i,s,c);g&&(this.loadImage(g)?this.image_=g:g.getState()===u.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(e){const t=this.frameState;if(!t)return null;const s=this.getLayer(),n=pe(t.pixelToCoordinateTransform,e.slice()),i=s.getExtent();if(i&&!Se(i,n))return null;const r=this.image_.getExtent(),o=this.image_.getImage(),a=O(r),c=Math.floor(o.width*((n[0]-r[0])/a));if(c<0||c>=o.width)return null;const g=x(r),I=Math.floor(o.height*((r[3]-n[1])/g));return I<0||I>=o.height?null:this.getImageData(o,c,I)}renderFrame(e,t){const s=this.image_,n=s.getExtent(),i=s.getResolution(),r=s.getPixelRatio(),o=e.layerStatesArray[e.layerIndex],a=e.pixelRatio,c=e.viewState,g=c.center,I=c.resolution,d=a*i/(I*r),_=e.extent,E=c.resolution,v=c.rotation,m=Math.round(O(_)/E*a),f=Math.round(x(_)/E*a);Y(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/a,1/a,v,-m/2,-f/2),Oe(this.inversePixelTransform,this.pixelTransform);const p=xe(this.pixelTransform);this.useContainer(t,p,this.getBackground(e));const l=this.context,S=l.canvas;S.width!=m||S.height!=f?(S.width=m,S.height=f):this.containerReused||l.clearRect(0,0,m,f);let M=!1,w=!0;if(o.extent){const L=W(o.extent,c.projection);w=ve(L,e.extent),M=w&&!J(L,e.extent),M&&this.clipUnrotated(l,e,L)}const A=s.getImage(),y=Y(this.tempTransform,m/2,f/2,d,d,0,r*(n[0]-g[0])/i,r*(g[1]-n[3])/i);this.renderedResolution=i*a/r;const N=A.width*y[0],F=A.height*y[3];if(this.getLayer().getSource().getInterpolate()||(l.imageSmoothingEnabled=!1),this.preRender(l,e),w&&N>=.5&&F>=.5){const L=y[4],te=y[5],P=o.opacity;let C;P!==1&&(C=l.globalAlpha,l.globalAlpha=P),l.drawImage(A,0,0,+A.width,+A.height,L,te,N,F),P!==1&&(l.globalAlpha=C)}return this.postRender(l,e),M&&l.restore(),l.imageSmoothingEnabled=!0,p!==S.style.transform&&(S.style.transform=p),this.container}}const we=Me;class Pe extends je{constructor(e){super(e)}createRenderer(){return new we(this)}getData(e){return super.getData(e)}}const Ce=Object.freeze(Object.defineProperty({__proto__:null,default:Pe},Symbol.toStringTag,{value:"Module"}));export{b as D,Z as I,q as a,Pe as b,Te as c,ee as d,Ce as e,Fe as f,Ne as g};
